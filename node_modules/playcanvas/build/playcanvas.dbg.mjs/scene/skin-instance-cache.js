import { RefCountedObject } from '../core/ref-counted-object.js';
import { SkinInstance } from './skin-instance.js';

// Class used as an entry in the ref-counted skin instance cache
class SkinInstanceCachedObject extends RefCountedObject {
  constructor(skin, skinInstance) {
    super();
    this.skin = skin;
    this.skinInstance = skinInstance;
  }
}

// Pure static class, implementing the cache of skin instances used by render component.
class SkinInstanceCache {
  // function that logs out the state of the skin instances cache
  static logCachedSkinInstances() {
    console.log('CachedSkinInstances');
    SkinInstanceCache._skinInstanceCache.forEach(function (array, rootBone) {
      console.log(`${rootBone.name}: Array(${array.length})`);
      for (let i = 0; i < array.length; i++) {
        console.log(`  ${i}: RefCount ${array[i].refCount}`);
      }
    });
  }

  // returns cached or creates a skin instance for the skin and a rootBone, to be used by render component
  // on the specified entity
  static createCachedSkinInstance(skin, rootBone, entity) {
    // try and get skin instance from the cache
    let skinInst = SkinInstanceCache.getCachedSkinInstance(skin, rootBone);

    // don't have skin instance for this skin
    if (!skinInst) {
      skinInst = new SkinInstance(skin);
      skinInst.resolve(rootBone, entity);

      // add it to the cache
      SkinInstanceCache.addCachedSkinInstance(skin, rootBone, skinInst);
    }
    return skinInst;
  }

  // returns already created skin instance from skin, for use on the rootBone
  // ref count of existing skinInstance is increased
  static getCachedSkinInstance(skin, rootBone) {
    let skinInstance = null;

    // get an array of cached object for the rootBone
    const cachedObjArray = SkinInstanceCache._skinInstanceCache.get(rootBone);
    if (cachedObjArray) {
      // find matching skin
      const cachedObj = cachedObjArray.find(element => element.skin === skin);
      if (cachedObj) {
        cachedObj.incRefCount();
        skinInstance = cachedObj.skinInstance;
      }
    }
    return skinInstance;
  }

  // adds skin instance to the cache, and increases ref count on it
  static addCachedSkinInstance(skin, rootBone, skinInstance) {
    // get an array for the rootBone
    let cachedObjArray = SkinInstanceCache._skinInstanceCache.get(rootBone);
    if (!cachedObjArray) {
      cachedObjArray = [];
      SkinInstanceCache._skinInstanceCache.set(rootBone, cachedObjArray);
    }

    // find entry for the skin
    let cachedObj = cachedObjArray.find(element => element.skin === skin);
    if (!cachedObj) {
      cachedObj = new SkinInstanceCachedObject(skin, skinInstance);
      cachedObjArray.push(cachedObj);
    }
    cachedObj.incRefCount();
  }

  // removes skin instance from the cache. This decreases ref count, and when that reaches 0 it gets destroyed
  static removeCachedSkinInstance(skinInstance) {
    if (skinInstance) {
      const rootBone = skinInstance.rootBone;
      if (rootBone) {
        // an array for boot bone
        const cachedObjArray = SkinInstanceCache._skinInstanceCache.get(rootBone);
        if (cachedObjArray) {
          // actual skin instance
          const cachedObjIndex = cachedObjArray.findIndex(element => element.skinInstance === skinInstance);
          if (cachedObjIndex >= 0) {
            // dec ref on the object
            const cachedObj = cachedObjArray[cachedObjIndex];
            cachedObj.decRefCount();

            // last reference, needs to be destroyed
            if (cachedObj.refCount === 0) {
              cachedObjArray.splice(cachedObjIndex, 1);

              // if the array is empty
              if (!cachedObjArray.length) {
                SkinInstanceCache._skinInstanceCache.delete(rootBone);
              }

              // destroy the skin instance
              if (skinInstance) {
                skinInstance.destroy();
                cachedObj.skinInstance = null;
              }
            }
          }
        }
      }
    }
  }
}
// map of SkinInstances allowing those to be shared between
// (specifically a single glb with multiple render components)
// It maps a rootBone to an array of SkinInstanceCachedObject
// this allows us to find if a skin instance already exists for a rootbone, and a specific skin
SkinInstanceCache._skinInstanceCache = new Map();

export { SkinInstanceCache };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2tpbi1pbnN0YW5jZS1jYWNoZS5qcyIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL3NjZW5lL3NraW4taW5zdGFuY2UtY2FjaGUuanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUmVmQ291bnRlZE9iamVjdCB9IGZyb20gJy4uL2NvcmUvcmVmLWNvdW50ZWQtb2JqZWN0LmpzJztcbmltcG9ydCB7IFNraW5JbnN0YW5jZSB9IGZyb20gJy4vc2tpbi1pbnN0YW5jZS5qcyc7XG5cbi8vIENsYXNzIHVzZWQgYXMgYW4gZW50cnkgaW4gdGhlIHJlZi1jb3VudGVkIHNraW4gaW5zdGFuY2UgY2FjaGVcbmNsYXNzIFNraW5JbnN0YW5jZUNhY2hlZE9iamVjdCBleHRlbmRzIFJlZkNvdW50ZWRPYmplY3Qge1xuICAgIGNvbnN0cnVjdG9yKHNraW4sIHNraW5JbnN0YW5jZSkge1xuICAgICAgICBzdXBlcigpO1xuICAgICAgICB0aGlzLnNraW4gPSBza2luO1xuICAgICAgICB0aGlzLnNraW5JbnN0YW5jZSA9IHNraW5JbnN0YW5jZTtcbiAgICB9XG59XG5cbi8vIFB1cmUgc3RhdGljIGNsYXNzLCBpbXBsZW1lbnRpbmcgdGhlIGNhY2hlIG9mIHNraW4gaW5zdGFuY2VzIHVzZWQgYnkgcmVuZGVyIGNvbXBvbmVudC5cbmNsYXNzIFNraW5JbnN0YW5jZUNhY2hlIHtcbiAgICAvLyBtYXAgb2YgU2tpbkluc3RhbmNlcyBhbGxvd2luZyB0aG9zZSB0byBiZSBzaGFyZWQgYmV0d2VlblxuICAgIC8vIChzcGVjaWZpY2FsbHkgYSBzaW5nbGUgZ2xiIHdpdGggbXVsdGlwbGUgcmVuZGVyIGNvbXBvbmVudHMpXG4gICAgLy8gSXQgbWFwcyBhIHJvb3RCb25lIHRvIGFuIGFycmF5IG9mIFNraW5JbnN0YW5jZUNhY2hlZE9iamVjdFxuICAgIC8vIHRoaXMgYWxsb3dzIHVzIHRvIGZpbmQgaWYgYSBza2luIGluc3RhbmNlIGFscmVhZHkgZXhpc3RzIGZvciBhIHJvb3Rib25lLCBhbmQgYSBzcGVjaWZpYyBza2luXG4gICAgc3RhdGljIF9za2luSW5zdGFuY2VDYWNoZSA9IG5ldyBNYXAoKTtcblxuICAgIC8vICNpZiBfREVCVUdcbiAgICAvLyBmdW5jdGlvbiB0aGF0IGxvZ3Mgb3V0IHRoZSBzdGF0ZSBvZiB0aGUgc2tpbiBpbnN0YW5jZXMgY2FjaGVcbiAgICBzdGF0aWMgbG9nQ2FjaGVkU2tpbkluc3RhbmNlcygpIHtcbiAgICAgICAgY29uc29sZS5sb2coJ0NhY2hlZFNraW5JbnN0YW5jZXMnKTtcbiAgICAgICAgU2tpbkluc3RhbmNlQ2FjaGUuX3NraW5JbnN0YW5jZUNhY2hlLmZvckVhY2goZnVuY3Rpb24gKGFycmF5LCByb290Qm9uZSkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coYCR7cm9vdEJvbmUubmFtZX06IEFycmF5KCR7YXJyYXkubGVuZ3RofSlgKTtcbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYXJyYXkubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgICAke2l9OiBSZWZDb3VudCAke2FycmF5W2ldLnJlZkNvdW50fWApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG4gICAgLy8gI2VuZGlmXG5cbiAgICAvLyByZXR1cm5zIGNhY2hlZCBvciBjcmVhdGVzIGEgc2tpbiBpbnN0YW5jZSBmb3IgdGhlIHNraW4gYW5kIGEgcm9vdEJvbmUsIHRvIGJlIHVzZWQgYnkgcmVuZGVyIGNvbXBvbmVudFxuICAgIC8vIG9uIHRoZSBzcGVjaWZpZWQgZW50aXR5XG4gICAgc3RhdGljIGNyZWF0ZUNhY2hlZFNraW5JbnN0YW5jZShza2luLCByb290Qm9uZSwgZW50aXR5KSB7XG5cbiAgICAgICAgLy8gdHJ5IGFuZCBnZXQgc2tpbiBpbnN0YW5jZSBmcm9tIHRoZSBjYWNoZVxuICAgICAgICBsZXQgc2tpbkluc3QgPSBTa2luSW5zdGFuY2VDYWNoZS5nZXRDYWNoZWRTa2luSW5zdGFuY2Uoc2tpbiwgcm9vdEJvbmUpO1xuXG4gICAgICAgIC8vIGRvbid0IGhhdmUgc2tpbiBpbnN0YW5jZSBmb3IgdGhpcyBza2luXG4gICAgICAgIGlmICghc2tpbkluc3QpIHtcblxuICAgICAgICAgICAgc2tpbkluc3QgPSBuZXcgU2tpbkluc3RhbmNlKHNraW4pO1xuICAgICAgICAgICAgc2tpbkluc3QucmVzb2x2ZShyb290Qm9uZSwgZW50aXR5KTtcblxuICAgICAgICAgICAgLy8gYWRkIGl0IHRvIHRoZSBjYWNoZVxuICAgICAgICAgICAgU2tpbkluc3RhbmNlQ2FjaGUuYWRkQ2FjaGVkU2tpbkluc3RhbmNlKHNraW4sIHJvb3RCb25lLCBza2luSW5zdCk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gc2tpbkluc3Q7XG4gICAgfVxuXG4gICAgLy8gcmV0dXJucyBhbHJlYWR5IGNyZWF0ZWQgc2tpbiBpbnN0YW5jZSBmcm9tIHNraW4sIGZvciB1c2Ugb24gdGhlIHJvb3RCb25lXG4gICAgLy8gcmVmIGNvdW50IG9mIGV4aXN0aW5nIHNraW5JbnN0YW5jZSBpcyBpbmNyZWFzZWRcbiAgICBzdGF0aWMgZ2V0Q2FjaGVkU2tpbkluc3RhbmNlKHNraW4sIHJvb3RCb25lKSB7XG5cbiAgICAgICAgbGV0IHNraW5JbnN0YW5jZSA9IG51bGw7XG5cbiAgICAgICAgLy8gZ2V0IGFuIGFycmF5IG9mIGNhY2hlZCBvYmplY3QgZm9yIHRoZSByb290Qm9uZVxuICAgICAgICBjb25zdCBjYWNoZWRPYmpBcnJheSA9IFNraW5JbnN0YW5jZUNhY2hlLl9za2luSW5zdGFuY2VDYWNoZS5nZXQocm9vdEJvbmUpO1xuICAgICAgICBpZiAoY2FjaGVkT2JqQXJyYXkpIHtcblxuICAgICAgICAgICAgLy8gZmluZCBtYXRjaGluZyBza2luXG4gICAgICAgICAgICBjb25zdCBjYWNoZWRPYmogPSBjYWNoZWRPYmpBcnJheS5maW5kKGVsZW1lbnQgPT4gZWxlbWVudC5za2luID09PSBza2luKTtcbiAgICAgICAgICAgIGlmIChjYWNoZWRPYmopIHtcbiAgICAgICAgICAgICAgICBjYWNoZWRPYmouaW5jUmVmQ291bnQoKTtcbiAgICAgICAgICAgICAgICBza2luSW5zdGFuY2UgPSBjYWNoZWRPYmouc2tpbkluc3RhbmNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHNraW5JbnN0YW5jZTtcbiAgICB9XG5cbiAgICAvLyBhZGRzIHNraW4gaW5zdGFuY2UgdG8gdGhlIGNhY2hlLCBhbmQgaW5jcmVhc2VzIHJlZiBjb3VudCBvbiBpdFxuICAgIHN0YXRpYyBhZGRDYWNoZWRTa2luSW5zdGFuY2Uoc2tpbiwgcm9vdEJvbmUsIHNraW5JbnN0YW5jZSkge1xuXG4gICAgICAgIC8vIGdldCBhbiBhcnJheSBmb3IgdGhlIHJvb3RCb25lXG4gICAgICAgIGxldCBjYWNoZWRPYmpBcnJheSA9IFNraW5JbnN0YW5jZUNhY2hlLl9za2luSW5zdGFuY2VDYWNoZS5nZXQocm9vdEJvbmUpO1xuICAgICAgICBpZiAoIWNhY2hlZE9iakFycmF5KSB7XG4gICAgICAgICAgICBjYWNoZWRPYmpBcnJheSA9IFtdO1xuICAgICAgICAgICAgU2tpbkluc3RhbmNlQ2FjaGUuX3NraW5JbnN0YW5jZUNhY2hlLnNldChyb290Qm9uZSwgY2FjaGVkT2JqQXJyYXkpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gZmluZCBlbnRyeSBmb3IgdGhlIHNraW5cbiAgICAgICAgbGV0IGNhY2hlZE9iaiA9IGNhY2hlZE9iakFycmF5LmZpbmQoZWxlbWVudCA9PiBlbGVtZW50LnNraW4gPT09IHNraW4pO1xuICAgICAgICBpZiAoIWNhY2hlZE9iaikge1xuICAgICAgICAgICAgY2FjaGVkT2JqID0gbmV3IFNraW5JbnN0YW5jZUNhY2hlZE9iamVjdChza2luLCBza2luSW5zdGFuY2UpO1xuICAgICAgICAgICAgY2FjaGVkT2JqQXJyYXkucHVzaChjYWNoZWRPYmopO1xuICAgICAgICB9XG5cbiAgICAgICAgY2FjaGVkT2JqLmluY1JlZkNvdW50KCk7XG4gICAgfVxuXG4gICAgLy8gcmVtb3ZlcyBza2luIGluc3RhbmNlIGZyb20gdGhlIGNhY2hlLiBUaGlzIGRlY3JlYXNlcyByZWYgY291bnQsIGFuZCB3aGVuIHRoYXQgcmVhY2hlcyAwIGl0IGdldHMgZGVzdHJveWVkXG4gICAgc3RhdGljIHJlbW92ZUNhY2hlZFNraW5JbnN0YW5jZShza2luSW5zdGFuY2UpIHtcblxuICAgICAgICBpZiAoc2tpbkluc3RhbmNlKSB7XG4gICAgICAgICAgICBjb25zdCByb290Qm9uZSA9IHNraW5JbnN0YW5jZS5yb290Qm9uZTtcbiAgICAgICAgICAgIGlmIChyb290Qm9uZSkge1xuXG4gICAgICAgICAgICAgICAgLy8gYW4gYXJyYXkgZm9yIGJvb3QgYm9uZVxuICAgICAgICAgICAgICAgIGNvbnN0IGNhY2hlZE9iakFycmF5ID0gU2tpbkluc3RhbmNlQ2FjaGUuX3NraW5JbnN0YW5jZUNhY2hlLmdldChyb290Qm9uZSk7XG4gICAgICAgICAgICAgICAgaWYgKGNhY2hlZE9iakFycmF5KSB7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gYWN0dWFsIHNraW4gaW5zdGFuY2VcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY2FjaGVkT2JqSW5kZXggPSBjYWNoZWRPYmpBcnJheS5maW5kSW5kZXgoZWxlbWVudCA9PiBlbGVtZW50LnNraW5JbnN0YW5jZSA9PT0gc2tpbkluc3RhbmNlKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNhY2hlZE9iakluZGV4ID49IDApIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gZGVjIHJlZiBvbiB0aGUgb2JqZWN0XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjYWNoZWRPYmogPSBjYWNoZWRPYmpBcnJheVtjYWNoZWRPYmpJbmRleF07XG4gICAgICAgICAgICAgICAgICAgICAgICBjYWNoZWRPYmouZGVjUmVmQ291bnQoKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gbGFzdCByZWZlcmVuY2UsIG5lZWRzIHRvIGJlIGRlc3Ryb3llZFxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNhY2hlZE9iai5yZWZDb3VudCA9PT0gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhY2hlZE9iakFycmF5LnNwbGljZShjYWNoZWRPYmpJbmRleCwgMSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBpZiB0aGUgYXJyYXkgaXMgZW1wdHlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWNhY2hlZE9iakFycmF5Lmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTa2luSW5zdGFuY2VDYWNoZS5fc2tpbkluc3RhbmNlQ2FjaGUuZGVsZXRlKHJvb3RCb25lKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBkZXN0cm95IHRoZSBza2luIGluc3RhbmNlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNraW5JbnN0YW5jZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBza2luSW5zdGFuY2UuZGVzdHJveSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYWNoZWRPYmouc2tpbkluc3RhbmNlID0gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG59XG5cbmV4cG9ydCB7IFNraW5JbnN0YW5jZUNhY2hlIH07XG4iXSwibmFtZXMiOlsiU2tpbkluc3RhbmNlQ2FjaGVkT2JqZWN0IiwiUmVmQ291bnRlZE9iamVjdCIsImNvbnN0cnVjdG9yIiwic2tpbiIsInNraW5JbnN0YW5jZSIsIlNraW5JbnN0YW5jZUNhY2hlIiwibG9nQ2FjaGVkU2tpbkluc3RhbmNlcyIsImNvbnNvbGUiLCJsb2ciLCJfc2tpbkluc3RhbmNlQ2FjaGUiLCJmb3JFYWNoIiwiYXJyYXkiLCJyb290Qm9uZSIsIm5hbWUiLCJsZW5ndGgiLCJpIiwicmVmQ291bnQiLCJjcmVhdGVDYWNoZWRTa2luSW5zdGFuY2UiLCJlbnRpdHkiLCJza2luSW5zdCIsImdldENhY2hlZFNraW5JbnN0YW5jZSIsIlNraW5JbnN0YW5jZSIsInJlc29sdmUiLCJhZGRDYWNoZWRTa2luSW5zdGFuY2UiLCJjYWNoZWRPYmpBcnJheSIsImdldCIsImNhY2hlZE9iaiIsImZpbmQiLCJlbGVtZW50IiwiaW5jUmVmQ291bnQiLCJzZXQiLCJwdXNoIiwicmVtb3ZlQ2FjaGVkU2tpbkluc3RhbmNlIiwiY2FjaGVkT2JqSW5kZXgiLCJmaW5kSW5kZXgiLCJkZWNSZWZDb3VudCIsInNwbGljZSIsImRlbGV0ZSIsImRlc3Ryb3kiLCJNYXAiXSwibWFwcGluZ3MiOiI7OztBQUdBO0FBQ0EsTUFBTUEsd0JBQXdCLFNBQVNDLGdCQUFnQixDQUFDO0FBQ3BEQyxFQUFBQSxXQUFXQSxDQUFDQyxJQUFJLEVBQUVDLFlBQVksRUFBRTtBQUM1QixJQUFBLEtBQUssRUFBRSxDQUFBO0lBQ1AsSUFBSSxDQUFDRCxJQUFJLEdBQUdBLElBQUksQ0FBQTtJQUNoQixJQUFJLENBQUNDLFlBQVksR0FBR0EsWUFBWSxDQUFBO0FBQ3BDLEdBQUE7QUFDSixDQUFBOztBQUVBO0FBQ0EsTUFBTUMsaUJBQWlCLENBQUM7QUFRcEI7RUFDQSxPQUFPQyxzQkFBc0JBLEdBQUc7QUFDNUJDLElBQUFBLE9BQU8sQ0FBQ0MsR0FBRyxDQUFDLHFCQUFxQixDQUFDLENBQUE7SUFDbENILGlCQUFpQixDQUFDSSxrQkFBa0IsQ0FBQ0MsT0FBTyxDQUFDLFVBQVVDLEtBQUssRUFBRUMsUUFBUSxFQUFFO0FBQ3BFTCxNQUFBQSxPQUFPLENBQUNDLEdBQUcsQ0FBRSxDQUFBLEVBQUVJLFFBQVEsQ0FBQ0MsSUFBSyxD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
