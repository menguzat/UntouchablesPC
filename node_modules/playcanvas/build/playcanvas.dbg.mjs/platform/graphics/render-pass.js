import { Debug } from '../../core/debug.js';
import { Tracing } from '../../core/tracing.js';
import { Color } from '../../core/math/color.js';
import { TRACEID_RENDER_PASS, TRACEID_RENDER_PASS_DETAIL } from '../../core/constants.js';
import { DebugGraphics } from './debug-graphics.js';

class ColorAttachmentOps {
  constructor() {
    /**
     * A color used to clear the color attachment when the clear is enabled.
     */
    this.clearValue = new Color(0, 0, 0, 1);
    /**
     * True if the attachment should be cleared before rendering, false to preserve
     * the existing content.
     */
    this.clear = false;
    /**
     * True if the attachment needs to be stored after the render pass. False
     * if it can be discarded.
     * Note: This relates to the surface that is getting rendered to, and can be either
     * single or multi-sampled. Further, if a multi-sampled surface is used, the resolve
     * flag further specifies if this gets resolved to a single-sampled surface. This
     * behavior matches the WebGPU specification.
     *
     * @type {boolean}
     */
    this.store = false;
    /**
     * True if the attachment needs to be resolved.
     *
     * @type {boolean}
     */
    this.resolve = true;
    /**
     * True if the attachment needs to have mipmaps generated.
     *
     * @type {boolean}
     */
    this.mipmaps = false;
  }
}
class DepthStencilAttachmentOps {
  constructor() {
    /**
     * A depth value used to clear the depth attachment when the clear is enabled.
     */
    this.clearDepthValue = 1;
    /**
     * A stencil value used to clear the stencil attachment when the clear is enabled.
     */
    this.clearStencilValue = 0;
    /**
     * True if the depth attachment should be cleared before rendering, false to preserve
     * the existing content.
     */
    this.clearDepth = false;
    /**
     * True if the stencil attachment should be cleared before rendering, false to preserve
     * the existing content.
     */
    this.clearStencil = false;
    /**
     * True if the depth attachment needs to be stored after the render pass. False
     * if it can be discarded.
     *
     * @type {boolean}
     */
    this.storeDepth = false;
    /**
     * True if the stencil attachment needs to be stored after the render pass. False
     * if it can be discarded.
     *
     * @type {boolean}
     */
    this.storeStencil = false;
  }
}

/**
 * A render pass represents a node in the frame graph, and encapsulates a system which
 * renders to a render target using an execution callback.
 *
 * @ignore
 */
class RenderPass {
  /**
   * Creates an instance of the RenderPass.
   *
   * @param {import('../graphics/graphics-device.js').GraphicsDevice} graphicsDevice - The
   * graphics device.
   * @param {Function} [execute] - Custom function that is called to render the pass.
   */
  constructor(graphicsDevice, execute) {
    /** @type {string} */
    this.name = void 0;
    /** @type {import('../graphics/render-target.js').RenderTarget} */
    this.renderTarget = void 0;
    /**
     * Number of samples. 0 if no render target, otherwise number of samples from the render target,
     * or the main framebuffer if render target is null.
     *
     * @type {number}
     */
    this.samples = 0;
    /** @type {ColorAttachmentOps} */
    this.colorOps = void 0;
    /** @type {DepthStencilAttachmentOps} */
    this.depthStencilOps = void 0;
    /**
     * If true, this pass might use dynamically rendered cubemaps. Use for a case where rendering to cubemap
     * faces is interleaved with rendering to shadows, to avoid generating cubemap mipmaps. This will likely
     * be retired when render target dependency tracking gets implemented.
     *
     * @type {boolean}
     */
    this.requiresCubemaps = true;
    /**
     * True if the render pass uses the full viewport / scissor for rendering into the render target.
     *
     * @type {boolean}
     */
    this.fullSizeClearRect = true;
    /**
     * Custom function that is called to render the pass.
     *
     * @type {Function}
     */
    this.execute = void 0;
    /**
     * Custom function that is called before the pass has started.
     *
     * @type {Function}
     */
    this.before = void 0;
    /**
     * Custom function that is called after the pass has fnished.
     *
     * @type {Function}
     */
    this.after = void 0;
    this.device = graphicsDevice;

    /** @type {Function} */
    this.execute = execute;
  }

  /**
   * @param {import('../graphics/render-target.js').RenderTarget} renderTarget - The render
   * target to render into (output). This function should be called only for render passes which
   * use render target, or passes which render directly into the default framebuffer, in which
   * case a null or undefined render target is expected.
   */
  init(renderTarget) {
    var _this$renderTarget, _this$renderTarget$co;
    // null represents the default framebuffer
    this.renderTarget = renderTarget || null;

    // allocate ops only when render target is used
    this.colorOps = new ColorAttachmentOps();
    this.depthStencilOps = new DepthStencilAttachmentOps();

    // defaults depend on multisampling
    this.samples = Math.max(this.renderTarget ? this.renderTarget.samples : this.device.samples, 1);

    // if rendering to single-sampled buffer, this buffer needs to be stored
    if (this.samples === 1) {
      this.colorOps.store = true;
      this.colorOps.resolve = false;
    }

    // if render target needs mipmaps
    if ((_this$renderTarget = this.renderTarget) != null && (_this$renderTarget$co = _this$renderTarget.colorBuffer) != null && _this$renderTarget$co.mipmaps) {
      this.colorOps.mipmaps = true;
    }
  }

  /**
   * Mark render pass as clearing the full color buffer.
   *
   * @param {Color} color - The color to clear to.
   */
  setClearColor(color) {
    this.colorOps.clearValue.copy(color);
    this.colorOps.clear = true;
  }

  /**
   * Mark render pass as clearing the full depth buffer.
   *
   * @param {number} depthValue - The depth value to clear to.
   */
  setClearDepth(depthValue) {
    this.depthStencilOps.clearDepthValue = depthValue;
    this.depthStencilOps.clearDepth = true;
  }

  /**
   * Mark render pass as clearing the full stencil buffer.
   *
   * @param {number} stencilValue - The stencil value to clear to.
   */
  setClearStencil(stencilValue) {
    this.depthStencilOps.clearStencilValue = stencilValue;
    this.depthStencilOps.clearStencil = true;
  }

  /**
   * Render the render pass
   */
  render() {
    var _this$before, _this$execute, _this$after;
    const device = this.device;
    const realPass = this.renderTarget !== undefined;
    DebugGraphics.pushGpuMarker(device, `Pass:${this.name}`);
    Debug.call(() => {
      this.log(device, device.renderPassIndex);
    });
    (_this$before = this.before) == null ? void 0 : _this$before.call(this);
    if (realPass) {
      device.startPass(this);
    }
    (_this$execute = this.execute) == null ? void 0 : _this$execute.call(this);
    if (realPass) {
      device.endPass(this);
    }
    (_this$after = this.after) == null ? void 0 : _this$after.call(this);
    device.renderPassIndex++;
    DebugGraphics.popGpuMarker(device);
  }
  log(device, index) {
    if (Tracing.get(TRACEID_RENDER_PASS) || Tracing.get(TRACEID_RENDER_PASS_DETAIL)) {
      var _rt$colorBuffer, _rt, _rt2, _rt3, _rt4;
      let rt = this.renderTarget;
      if (rt === null && device.isWebGPU) {
        rt = device.frameBuffer;
      }
      const hasColor = (_rt$colorBuffer = (_rt = rt) == null ? void 0 : _rt.colorBuffer) != null ? _rt$colorBuffer : (_rt2 = rt) == null ? void 0 : _rt2.impl.assignedColorTexture;
      const hasDepth = (_rt3 = rt) == null ? void 0 : _rt3.depth;
      const hasStencil = (_rt4 = rt) == null ? void 0 : _rt4.stencil;
      const rtInfo = rt === undefined ? '' : ` RT: ${rt ? rt.name : 'NULL'} ` + `${hasColor ? '[Color]' : ''}` + `${hasDepth ? '[Depth]' : ''}` + `${hasStencil ? '[Stencil]' : ''}` + `${this.samples > 0 ? ' samples: ' + this.samples : ''}`;
      Debug.trace(TRACEID_RENDER_PASS, `${index.toString().padEnd(2, ' ')}: ${this.name.padEnd(20, ' ')}` + rtInfo.padEnd(30));
      if (this.colorOps && hasColor) {
        Debug.trace(TRACEID_RENDER_PASS_DETAIL, `    colorOps: ` + `${this.colorOps.clear ? 'clear' : 'load'}->` + `${this.colorOps.store ? 'store' : 'discard'} ` + `${this.colorOps.resolve ? 'resolve ' : ''}` + `${this.colorOps.mipmaps ? 'mipmaps ' : ''}`);
      }
      if (this.depthStencilOps) {
        if (hasDepth) {
          Debug.trace(TRACEID_RENDER_PASS_DETAIL, `    depthOps: ` + `${this.depthStencilOps.clearDepth ? 'clear' : 'load'}->` + `${this.depthStencilOps.storeDepth ? 'store' : 'discard'}`);
        }
        if (hasStencil) {
          Debug.trace(TRACEID_RENDER_PASS_DETAIL, `    stencOps: ` + `${this.depthStencilOps.clearStencil ? 'clear' : 'load'}->` + `${this.depthStencilOps.storeStencil ? 'store' : 'discard'}`);
        }
      }
    }
  }
}

export { ColorAttachmentOps, DepthStencilAttachmentOps, RenderPass };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmVuZGVyLXBhc3MuanMiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9wbGF0Zm9ybS9ncmFwaGljcy9yZW5kZXItcGFzcy5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBEZWJ1ZyB9IGZyb20gJy4uLy4uL2NvcmUvZGVidWcuanMnO1xuaW1wb3J0IHsgVHJhY2luZyB9IGZyb20gJy4uLy4uL2NvcmUvdHJhY2luZy5qcyc7XG5pbXBvcnQgeyBDb2xvciB9IGZyb20gJy4uLy4uL2NvcmUvbWF0aC9jb2xvci5qcyc7XG5pbXBvcnQgeyBUUkFDRUlEX1JFTkRFUl9QQVNTLCBUUkFDRUlEX1JFTkRFUl9QQVNTX0RFVEFJTCB9IGZyb20gJy4uLy4uL2NvcmUvY29uc3RhbnRzLmpzJztcbmltcG9ydCB7IERlYnVnR3JhcGhpY3MgfSBmcm9tICcuLi9ncmFwaGljcy9kZWJ1Zy1ncmFwaGljcy5qcyc7XG5cbmNsYXNzIENvbG9yQXR0YWNobWVudE9wcyB7XG4gICAgLyoqXG4gICAgICogQSBjb2xvciB1c2VkIHRvIGNsZWFyIHRoZSBjb2xvciBhdHRhY2htZW50IHdoZW4gdGhlIGNsZWFyIGlzIGVuYWJsZWQuXG4gICAgICovXG4gICAgY2xlYXJWYWx1ZSA9IG5ldyBDb2xvcigwLCAwLCAwLCAxKTtcblxuICAgIC8qKlxuICAgICAqIFRydWUgaWYgdGhlIGF0dGFjaG1lbnQgc2hvdWxkIGJlIGNsZWFyZWQgYmVmb3JlIHJlbmRlcmluZywgZmFsc2UgdG8gcHJlc2VydmVcbiAgICAgKiB0aGUgZXhpc3RpbmcgY29udGVudC5cbiAgICAgKi9cbiAgICBjbGVhciA9IGZhbHNlO1xuXG4gICAgLyoqXG4gICAgICogVHJ1ZSBpZiB0aGUgYXR0YWNobWVudCBuZWVkcyB0byBiZSBzdG9yZWQgYWZ0ZXIgdGhlIHJlbmRlciBwYXNzLiBGYWxzZVxuICAgICAqIGlmIGl0IGNhbiBiZSBkaXNjYXJkZWQuXG4gICAgICogTm90ZTogVGhpcyByZWxhdGVzIHRvIHRoZSBzdXJmYWNlIHRoYXQgaXMgZ2V0dGluZyByZW5kZXJlZCB0bywgYW5kIGNhbiBiZSBlaXRoZXJcbiAgICAgKiBzaW5nbGUgb3IgbXVsdGktc2FtcGxlZC4gRnVydGhlciwgaWYgYSBtdWx0aS1zYW1wbGVkIHN1cmZhY2UgaXMgdXNlZCwgdGhlIHJlc29sdmVcbiAgICAgKiBmbGFnIGZ1cnRoZXIgc3BlY2lmaWVzIGlmIHRoaXMgZ2V0cyByZXNvbHZlZCB0byBhIHNpbmdsZS1zYW1wbGVkIHN1cmZhY2UuIFRoaXNcbiAgICAgKiBiZWhhdmlvciBtYXRjaGVzIHRoZSBXZWJHUFUgc3BlY2lmaWNhdGlvbi5cbiAgICAgKlxuICAgICAqIEB0eXBlIHtib29sZWFufVxuICAgICAqL1xuICAgIHN0b3JlID0gZmFsc2U7XG5cbiAgICAvKipcbiAgICAgKiBUcnVlIGlmIHRoZSBhdHRhY2htZW50IG5lZWRzIHRvIGJlIHJlc29sdmVkLlxuICAgICAqXG4gICAgICogQHR5cGUge2Jvb2xlYW59XG4gICAgICovXG4gICAgcmVzb2x2ZSA9IHRydWU7XG5cbiAgICAvKipcbiAgICAgKiBUcnVlIGlmIHRoZSBhdHRhY2htZW50IG5lZWRzIHRvIGhhdmUgbWlwbWFwcyBnZW5lcmF0ZWQuXG4gICAgICpcbiAgICAgKiBAdHlwZSB7Ym9vbGVhbn1cbiAgICAgKi9cbiAgICBtaXBtYXBzID0gZmFsc2U7XG59XG5cbmNsYXNzIERlcHRoU3RlbmNpbEF0dGFjaG1lbnRPcHMge1xuICAgIC8qKlxuICAgICAqIEEgZGVwdGggdmFsdWUgdXNlZCB0byBjbGVhciB0aGUgZGVwdGggYXR0YWNobWVudCB3aGVuIHRoZSBjbGVhciBpcyBlbmFibGVkLlxuICAgICAqL1xuICAgIGNsZWFyRGVwdGhWYWx1ZSA9IDE7XG5cbiAgICAvKipcbiAgICAgKiBBIHN0ZW5jaWwgdmFsdWUgdXNlZCB0byBjbGVhciB0aGUgc3RlbmNpbCBhdHRhY2htZW50IHdoZW4gdGhlIGNsZWFyIGlzIGVuYWJsZWQuXG4gICAgICovXG4gICAgY2xlYXJTdGVuY2lsVmFsdWUgPSAwO1xuXG4gICAgLyoqXG4gICAgICogVHJ1ZSBpZiB0aGUgZGVwdGggYXR0YWNobWVudCBzaG91bGQgYmUgY2xlYXJlZCBiZWZvcmUgcmVuZGVyaW5nLCBmYWxzZSB0byBwcmVzZXJ2ZVxuICAgICAqIHRoZSBleGlzdGluZyBjb250ZW50LlxuICAgICAqL1xuICAgIGNsZWFyRGVwdGggPSBmYWxzZTtcblxuICAgIC8qKlxuICAgICAqIFRydWUgaWYgdGhlIHN0ZW5jaWwgYXR0YWNobWVudCBzaG91bGQgYmUgY2xlYXJlZCBiZWZvcmUgcmVuZGVyaW5nLCBmYWxzZSB0byBwcmVzZXJ2ZVxuICAgICAqIHRoZSBleGlzdGluZyBjb250ZW50LlxuICAgICAqL1xuICAgIGNsZWFyU3RlbmNpbCA9IGZhbHNlO1xuXG4gICAgLyoqXG4gICAgICogVHJ1ZSBpZiB0aGUgZGVwdGggYXR0YWNobWVudCBuZWVkcyB0byBiZSBzdG9yZWQgYWZ0ZXIgdGhlIHJlbmRlciBwYXNzLiBGYWxzZVxuICAgICAqIGlmIGl0IGNhbiBiZSBkaXNjYXJkZWQuXG4gICAgICpcbiAgICAgKiBAdHlwZSB7Ym9vbGVhbn1cbiAgICAgKi9cbiAgICBzdG9yZURlcHRoID0gZmFsc2U7XG5cbiAgICAvKipcbiAgICAgKiBUcnVlIGlmIHRoZSBzdGVuY2lsIGF0dGFjaG1lbnQgbmVlZHMgdG8gYmUgc3RvcmVkIGFmdGVyIHRoZSByZW5kZXIgcGFzcy4gRmFsc2VcbiAgICAgKiBpZiBpdCBjYW4gYmUgZGlzY2FyZGVkLlxuICAgICAqXG4gICAgICogQHR5cGUge2Jvb2xlYW59XG4gICAgICovXG4gICAgc3RvcmVTdGVuY2lsID0gZmFsc2U7XG59XG5cbi8qKlxuICogQSByZW5kZXIgcGFzcyByZXByZXNlbnRzIGEgbm9kZSBpbiB0aGUgZnJhbWUgZ3JhcGgsIGFuZCBlbmNhcHN1bGF0ZXMgYSBzeXN0ZW0gd2hpY2hcbiAqIHJlbmRlcnMgdG8gYSByZW5kZXIgdGFyZ2V0IHVzaW5nIGFuIGV4ZWN1dGlvbiBjYWxsYmFjay5cbiAqXG4gKiBAaWdub3JlXG4gKi9cbmNsYXNzIFJlbmRlclBhc3Mge1xuICAgIC8qKiBAdHlwZSB7c3RyaW5nfSAqL1xuICAgIG5hbWU7XG5cbiAgICAvKiogQHR5cGUge2ltcG9ydCgnLi4vZ3JhcGhpY3MvcmVuZGVyLXRhcmdldC5qcycpLlJlbmRlclRhcmdldH0gKi9cbiAgICByZW5kZXJUYXJnZXQ7XG5cbiAgICAvKipcbiAgICAgKiBOdW1iZXIgb2Ygc2FtcGxlcy4gMCBpZiBubyByZW5kZXIgdGFyZ2V0LCBvdGhlcndpc2UgbnVtYmVyIG9mIHNhbXBsZXMgZnJvbSB0aGUgcmVuZGVyIHRhcmdldCxcbiAgICAgKiBvciB0aGUgbWFpbiBmcmFtZWJ1ZmZlciBpZiByZW5kZXIgdGFyZ2V0IGlzIG51bGwuXG4gICAgICpcbiAgICAgKiBAdHlwZSB7bnVtYmVyfVxuICAgICAqL1xuICAgIHNhbXBsZXMgPSAwO1xuXG4gICAgLyoqIEB0eXBlIHtDb2xvckF0dGFjaG1lbnRPcHN9ICovXG4gICAgY29sb3JPcHM7XG5cbiAgICAvKiogQHR5cGUge0RlcHRoU3RlbmNpbEF0dGFjaG1lbnRPcHN9ICovXG4gICAgZGVwdGhTdGVuY2lsT3BzO1xuXG4gICAgLyoqXG4gICAgICogSWYgdHJ1ZSwgdGhpcyBwYXNzIG1pZ2h0IHVzZSBkeW5hbWljYWxseSByZW5kZXJlZCBjdWJlbWFwcy4gVXNlIGZvciBhIGNhc2Ugd2hlcmUgcmVuZGVyaW5nIHRvIGN1YmVtYXBcbiAgICAgKiBmYWNlcyBpcyBpbnRlcmxlYXZlZCB3aXRoIHJlbmRlcmluZyB0byBzaGFkb3dzLCB0byBhdm9pZCBnZW5lcmF0aW5nIGN1YmVtYXAgbWlwbWFwcy4gVGhpcyB3aWxsIGxpa2VseVxuICAgICAqIGJlIHJldGlyZWQgd2hlbiByZW5kZXIgdGFyZ2V0IGRlcGVuZGVuY3kgdHJhY2tpbmcgZ2V0cyBpbXBsZW1lbnRlZC5cbiAgICAgKlxuICAgICAqIEB0eXBlIHtib29sZWFufVxuICAgICAqL1xuICAgIHJlcXVpcmVzQ3ViZW1hcHMgPSB0cnVlO1xuXG4gICAgLyoqXG4gICAgICogVHJ1ZSBpZiB0aGUgcmVuZGVyIHBhc3MgdXNlcyB0aGUgZnVsbCB2aWV3cG9ydCAvIHNjaXNzb3IgZm9yIHJlbmRlcmluZyBpbnRvIHRoZSByZW5kZXIgdGFyZ2V0LlxuICAgICAqXG4gICAgICogQHR5cGUge2Jvb2xlYW59XG4gICAgICovXG4gICAgZnVsbFNpemVDbGVhclJlY3QgPSB0cnVlO1xuXG4gICAgLyoqXG4gICAgICogQ3VzdG9tIGZ1bmN0aW9uIHRoYXQgaXMgY2FsbGVkIHRvIHJlbmRlciB0aGUgcGFzcy5cbiAgICAgKlxuICAgICAqIEB0eXBlIHtGdW5jdGlvbn1cbiAgICAgKi9cbiAgICBleGVjdXRlO1xuXG4gICAgLyoqXG4gICAgICogQ3VzdG9tIGZ1bmN0aW9uIHRoYXQgaXMgY2FsbGVkIGJlZm9yZSB0aGUgcGFzcyBoYXMgc3RhcnRlZC5cbiAgICAgKlxuICAgICAqIEB0eXBlIHtGdW5jdGlvbn1cbiAgICAgKi9cbiAgICBiZWZvcmU7XG5cbiAgICAvKipcbiAgICAgKiBDdXN0b20gZnVuY3Rpb24gdGhhdCBpcyBjYWxsZWQgYWZ0ZXIgdGhlIHBhc3MgaGFzIGZuaXNoZWQuXG4gICAgICpcbiAgICAgKiBAdHlwZSB7RnVuY3Rpb259XG4gICAgICovXG4gICAgYWZ0ZXI7XG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGFuIGluc3RhbmNlIG9mIHRoZSBSZW5kZXJQYXNzLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtpbXBvcnQoJy4uL2dyYXBoaWNzL2dyYXBoaWNzLWRldmljZS5qcycpLkdyYXBoaWNzRGV2aWNlfSBncmFwaGljc0RldmljZSAtIFRoZVxuICAgICAqIGdyYXBoaWNzIGRldmljZS5cbiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbZXhlY3V0ZV0gLSBDdXN0b20gZnVuY3Rpb24gdGhhdCBpcyBjYWxsZWQgdG8gcmVuZGVyIHRoZSBwYXNzLlxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKGdyYXBoaWNzRGV2aWNlLCBleGVjdXRlKSB7XG4gICAgICAgIHRoaXMuZGV2aWNlID0gZ3JhcGhpY3NEZXZpY2U7XG5cbiAgICAgICAgLyoqIEB0eXBlIHtGdW5jdGlvbn0gKi9cbiAgICAgICAgdGhpcy5leGVjdXRlID0gZXhlY3V0ZTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge2ltcG9ydCgnLi4vZ3JhcGhpY3MvcmVuZGVyLXRhcmdldC5qcycpLlJlbmRlclRhcmdldH0gcmVuZGVyVGFyZ2V0IC0gVGhlIHJlbmRlclxuICAgICAqIHRhcmdldCB0byByZW5kZXIgaW50byAob3V0cHV0KS4gVGhpcyBmdW5jdGlvbiBzaG91bGQgYmUgY2FsbGVkIG9ubHkgZm9yIHJlbmRlciBwYXNzZXMgd2hpY2hcbiAgICAgKiB1c2UgcmVuZGVyIHRhcmdldCwgb3IgcGFzc2VzIHdoaWNoIHJlbmRlciBkaXJlY3RseSBpbnRvIHRoZSBkZWZhdWx0IGZyYW1lYnVmZmVyLCBpbiB3aGljaFxuICAgICAqIGNhc2UgYSBudWxsIG9yIHVuZGVmaW5lZCByZW5kZXIgdGFyZ2V0IGlzIGV4cGVjdGVkLlxuICAgICAqL1xuICAgIGluaXQocmVuZGVyVGFyZ2V0KSB7XG5cbiAgICAgICAgLy8gbnVsbCByZXByZXNlbnRzIHRoZSBkZWZhdWx0IGZyYW1lYnVmZmVyXG4gICAgICAgIHRoaXMucmVuZGVyVGFyZ2V0ID0gcmVuZGVyVGFyZ2V0IHx8IG51bGw7XG5cbiAgICAgICAgLy8gYWxsb2NhdGUgb3BzIG9ubHkgd2hlbiByZW5kZXIgdGFyZ2V0IGlzIHVzZWRcbiAgICAgICAgdGhpcy5jb2xvck9wcyA9IG5ldyBDb2xvckF0dGFjaG1lbnRPcHMoKTtcbiAgICAgICAgdGhpcy5kZXB0aFN0ZW5jaWxPcHMgPSBuZXcgRGVwdGhTdGVuY2lsQXR0YWNobWVudE9wcygpO1xuXG4gICAgICAgIC8vIGRlZmF1bHRzIGRlcGVuZCBvbiBtdWx0aXNhbXBsaW5nXG4gICAgICAgIHRoaXMuc2FtcGxlcyA9IE1hdGgubWF4KHRoaXMucmVuZGVyVGFyZ2V0ID8gdGhpcy5yZW5kZXJUYXJnZXQuc2FtcGxlcyA6IHRoaXMuZGV2aWNlLnNhbXBsZXMsIDEpO1xuXG4gICAgICAgIC8vIGlmIHJlbmRlcmluZyB0byBzaW5nbGUtc2FtcGxlZCBidWZmZXIsIHRoaXMgYnVmZmVyIG5lZWRzIHRvIGJlIHN0b3JlZFxuICAgICAgICBpZiAodGhpcy5zYW1wbGVzID09PSAxKSB7XG4gICAgICAgICAgICB0aGlzLmNvbG9yT3BzLnN0b3JlID0gdHJ1ZTtcbiAgICAgICAgICAgIHRoaXMuY29sb3JPcHMucmVzb2x2ZSA9IGZhbHNlO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gaWYgcmVuZGVyIHRhcmdldCBuZWVkcyBtaXBtYXBzXG4gICAgICAgIGlmICh0aGlzLnJlbmRlclRhcmdldD8uY29sb3JCdWZmZXI/Lm1pcG1hcHMpIHtcbiAgICAgICAgICAgIHRoaXMuY29sb3JPcHMubWlwbWFwcyA9IHRydWU7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBNYXJrIHJlbmRlciBwYXNzIGFzIGNsZWFyaW5nIHRoZSBmdWxsIGNvbG9yIGJ1ZmZlci5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7Q29sb3J9IGNvbG9yIC0gVGhlIGNvbG9yIHRvIGNsZWFyIHRvLlxuICAgICAqL1xuICAgIHNldENsZWFyQ29sb3IoY29sb3IpIHtcbiAgICAgICAgdGhpcy5jb2xvck9wcy5jbGVhclZhbHVlLmNvcHkoY29sb3IpO1xuICAgICAgICB0aGlzLmNvbG9yT3BzLmNsZWFyID0gdHJ1ZTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBNYXJrIHJlbmRlciBwYXNzIGFzIGNsZWFyaW5nIHRoZSBmdWxsIGRlcHRoIGJ1ZmZlci5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBkZXB0aFZhbHVlIC0gVGhlIGRlcHRoIHZhbHVlIHRvIGNsZWFyIHRvLlxuICAgICAqL1xuICAgIHNldENsZWFyRGVwdGgoZGVwdGhWYWx1ZSkge1xuICAgICAgICB0aGlzLmRlcHRoU3RlbmNpbE9wcy5jbGVhckRlcHRoVmFsdWUgPSBkZXB0aFZhbHVlO1xuICAgICAgICB0aGlzLmRlcHRoU3RlbmNpbE9wcy5jbGVhckRlcHRoID0gdHJ1ZTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBNYXJrIHJlbmRlciBwYXNzIGFzIGNsZWFyaW5nIHRoZSBmdWxsIHN0ZW5jaWwgYnVmZmVyLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IHN0ZW5jaWxWYWx1ZSAtIFRoZSBzdGVuY2lsIHZhbHVlIHRvIGNsZWFyIHRvLlxuICAgICAqL1xuICAgIHNldENsZWFyU3RlbmNpbChzdGVuY2lsVmFsdWUpIHtcbiAgICAgICAgdGhpcy5kZXB0aFN0ZW5jaWxPcHMuY2xlYXJTdGVuY2lsVmFsdWUgPSBzdGVuY2lsVmFsdWU7XG4gICAgICAgIHRoaXMuZGVwdGhTdGVuY2lsT3BzLmNsZWFyU3RlbmNpbCA9IHRydWU7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmVuZGVyIHRoZSByZW5kZXIgcGFzc1xuICAgICAqL1xuICAgIHJlbmRlcigpIHtcblxuICAgICAgICBjb25zdCBkZXZpY2UgPSB0aGlzLmRldmljZTtcbiAgICAgICAgY29uc3QgcmVhbFBhc3MgPSB0aGlzLnJlbmRlclRhcmdldCAhPT0gdW5kZWZpbmVkO1xuICAgICAgICBEZWJ1Z0dyYXBoaWNzLnB1c2hHcHVNYXJrZXIoZGV2aWNlLCBgUGFzczoke3RoaXMubmFtZX1gKTtcblxuICAgICAgICBEZWJ1Zy5jYWxsKCgpID0+IHtcbiAgICAgICAgICAgIHRoaXMubG9nKGRldmljZSwgZGV2aWNlLnJlbmRlclBhc3NJbmRleCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMuYmVmb3JlPy4oKTtcblxuICAgICAgICBpZiAocmVhbFBhc3MpIHtcbiAgICAgICAgICAgIGRldmljZS5zdGFydFBhc3ModGhpcyk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmV4ZWN1dGU/LigpO1xuXG4gICAgICAgIGlmIChyZWFsUGFzcykge1xuICAgICAgICAgICAgZGV2aWNlLmVuZFBhc3ModGhpcyk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmFmdGVyPy4oKTtcblxuICAgICAgICBkZXZpY2UucmVuZGVyUGFzc0luZGV4Kys7XG5cbiAgICAgICAgRGVidWdHcmFwaGljcy5wb3BHcHVNYXJrZXIoZGV2aWNlKTtcblxuICAgIH1cblxuICAgIC8vICNpZiBfREVCVUdcbiAgICBsb2coZGV2aWNlLCBpbmRleCkge1xuICAgICAgICBpZiAoVHJhY2luZy5nZXQoVFJBQ0VJRF9SRU5ERVJfUEFTUykgfHwgVHJhY2luZy5nZXQoVFJBQ0VJRF9SRU5ERVJfUEFTU19ERVRBSUwpKSB7XG5cbiAgICAgICAgICAgIGxldCBydCA9IHRoaXMucmVuZGVyVGFyZ2V0O1xuICAgICAgICAgICAgaWYgKHJ0ID09PSBudWxsICYmIGRldmljZS5pc1dlYkdQVSkge1xuICAgICAgICAgICAgICAgIHJ0ID0gZGV2aWNlLmZyYW1lQnVmZmVyO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgaGFzQ29sb3IgPSBydD8uY29sb3JCdWZmZXIgPz8gcnQ/LmltcGwuYXNzaWduZWRDb2xvclRleHR1cmU7XG4gICAgICAgICAgICBjb25zdCBoYXNEZXB0aCA9IHJ0Py5kZXB0aDtcbiAgICAgICAgICAgIGNvbnN0IGhhc1N0ZW5jaWwgPSBydD8uc3RlbmNpbDtcbiAgICAgICAgICAgIGNvbnN0IHJ0SW5mbyA9IHJ0ID09PSB1bmRlZmluZWQgPyAnJyA6IGAgUlQ6ICR7KHJ0ID8gcnQubmFtZSA6ICdOVUxMJyl9IGAgK1xuICAgICAgICAgICAgICAgIGAke2hhc0NvbG9yID8gJ1tDb2xvcl0nIDogJyd9YCArXG4gICAgICAgICAgICAgICAgYCR7aGFzRGVwdGggPyAnW0RlcHRoXScgOiAnJ31gICtcbiAgICAgICAgICAgICAgICBgJHtoYXNTdGVuY2lsID8gJ1tTdGVuY2lsXScgOiAnJ31gICtcbiAgICAgICAgICAgICAgICBgJHsodGhpcy5zYW1wbGVzID4gMCA/ICcgc2FtcGxlczogJyArIHRoaXMuc2FtcGxlcyA6ICcnKX1gO1xuXG4gICAgICAgICAgICBEZWJ1Zy50cmFjZShUUkFDRUlEX1JFTkRFUl9QQVNTLFxuICAgICAgICAgICAgICAgICAgICAgICAgYCR7aW5kZXgudG9TdHJpbmcoKS5wYWRFbmQoMiwgJyAnKX06ICR7dGhpcy5uYW1lLnBhZEVuZCgyMCwgJyAnKX1gICtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJ0SW5mby5wYWRFbmQoMzApKTtcblxuICAgICAgICAgICAgaWYgKHRoaXMuY29sb3JPcHMgJiYgaGFzQ29sb3IpIHtcbiAgICAgICAgICAgICAgICBEZWJ1Zy50cmFjZShUUkFDRUlEX1JFTkRFUl9QQVNTX0RFVEFJTCwgYCAgICBjb2xvck9wczogYCArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYCR7dGhpcy5jb2xvck9wcy5jbGVhciA/ICdjbGVhcicgOiAnbG9hZCd9LT5gICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBgJHt0aGlzLmNvbG9yT3BzLnN0b3JlID8gJ3N0b3JlJyA6ICdkaXNjYXJkJ30gYCArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYCR7dGhpcy5jb2xvck9wcy5yZXNvbHZlID8gJ3Jlc29sdmUgJyA6ICcnfWAgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGAke3RoaXMuY29sb3JPcHMubWlwbWFwcyA/ICdtaXBtYXBzICcgOiAnJ31gKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHRoaXMuZGVwdGhTdGVuY2lsT3BzKSB7XG5cbiAgICAgICAgICAgICAgICBpZiAoaGFzRGVwdGgpIHtcbiAgICAgICAgICAgICAgICAgICAgRGVidWcudHJhY2UoVFJBQ0VJRF9SRU5ERVJfUEFTU19ERVRBSUwsIGAgICAgZGVwdGhPcHM6IGAgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBgJHt0aGlzLmRlcHRoU3RlbmNpbE9wcy5jbGVhckRlcHRoID8gJ2NsZWFyJyA6ICdsb2FkJ30tPmAgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBgJHt0aGlzLmRlcHRoU3RlbmNpbE9wcy5zdG9yZURlcHRoID8gJ3N0b3JlJyA6ICdkaXNjYXJkJ31gKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAoaGFzU3RlbmNpbCkge1xuICAgICAgICAgICAgICAgICAgICBEZWJ1Zy50cmFjZShUUkFDRUlEX1JFTkRFUl9QQVNTX0RFVEFJTCwgYCAgICBzdGVuY09wczogYCArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGAke3RoaXMuZGVwdGhTdGVuY2lsT3BzLmNsZWFyU3RlbmNpbCA/ICdjbGVhcicgOiAnbG9hZCd9LT5gICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYCR7dGhpcy5kZXB0aFN0ZW5jaWxPcHMuc3RvcmVTdGVuY2lsID8gJ3N0b3JlJyA6ICdkaXNjYXJkJ31gKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgLy8gI2VuZGlmXG59XG5cbmV4cG9ydCB7IFJlbmRlclBhc3MsIENvbG9yQXR0YWNobWVudE9wcywgRGVwdGhTdGVuY2lsQXR0YWNobWVudE9wcyB9O1xuIl0sIm5hbWVzIjpbIkNvbG9yQXR0YWNobWVudE9wcyIsImNvbnN0cnVjdG9yIiwiY2xlYXJWYWx1ZSIsIkNvbG9yIiwiY2xlYXIiLCJzdG9yZSIsInJlc29sdmUiLCJtaXBtYXBzIiwiRGVwdGhTdGVuY2lsQXR0YWNobWVudE9wcyIsImNsZWFyRGVwdGhWYWx1ZSIsImNsZWFyU3RlbmNpbFZhbHVlIiwiY2xlYXJEZXB0aCIsImNsZWFyU3RlbmNpbCIsInN0b3JlRGVwdGgiLCJzdG9yZVN0ZW5jaWwiLCJSZW5kZXJQYXNzIiwiZ3JhcGhpY3NEZXZpY2UiLCJleGVjdXRlIiwibmFtZSIsInJlbmRlclRhcmdldCIsInNhbXBsZXMiLCJjb2xvck9wcyIsImRlcHRoU3RlbmNpbE9wcyIsInJlcXVpcmVzQ3ViZW1hcHMiLCJmdWxsU2l6ZUNsZWFyUmVjdCIsImJlZm9yZSIsImFmdGVyIiwiZGV2aWNlIiwiaW5pdCIsIl90aGlzJHJlbmRlclRhcmdldCIsIl90aGlzJHJlbmRlclRhcmdldCRjbyIsIk1hdGgiLCJtYXgiLCJjb2xvckJ1ZmZlciIsInNldENsZWFyQ29sb3IiLCJjb2xvciIsImNvcHkiLCJzZXRDbGVhckRlcHRoIiwiZGVwdGhWYWx1ZSIsInNldENsZWFyU3RlbmNpbCIsInN0ZW5jaWxWYWx1ZSIsInJlbmRlciIsIl90aGlzJGJlZm9yZSIsIl90aGlzJGV4ZWN1dGUiLCJfdGhpcyRhZnRlciIsInJlYWxQYXNzIiwidW5kZWZpbmVkIiwiRGVidWdHcmFwaGljcyIsInB1c2hHcHVNYXJrZXIiLCJEZWJ1ZyIsImNhbGwiLCJsb2ciLCJyZW5kZXJQYXNzSW5kZXgiLCJzdGFydFBhc3MiLCJlbmRQYXNzIiwicG9wR3B1TWFya2VyIiwiaW5kZXgiLCJUcmFjaW5nIiwiZ2V0IiwiVFJBQ0VJRF9SRU5ERVJfUEFTUyIsIlRSQUNFSURfUkVOREVSX1BBU1NfREVUQUlMIiwiX3J0JGNvbG9yQnVmZmVyIiwiX3J0IiwiX3J0MiIsIl9ydDMiLCJfcnQ0IiwicnQiLCJpc1dlYkdQVSIsImZyYW1lQnVmZmVyIiwiaGFzQ29sb3IiLCJpbXBsIiwiYXNzaWduZWRDb2xvclRleHR1cmUiLCJoYXNEZXB0aCIsImRlcHRoIiwiaGFzU3RlbmNpbCIsInN0ZW5jaWwiLCJydEluZm8iLCJ0cmFjZSIsInRvU3RyaW5nIiwicGFkRW5kIl0sIm1hcHBpbmdzIjoiOzs7Ozs7QUFNQSxNQUFNQSxrQkFBa0IsQ0FBQztFQUFBQyxXQUFBLEdBQUE7QUFDckI7QUFDSjtBQUNBO0FBRkksSUFBQSxJQUFBLENBR0FDLFVBQVUsR0FBRyxJQUFJQyxLQUFLLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUE7QUFFbEM7QUFDSjtBQUNBO0FBQ0E7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
