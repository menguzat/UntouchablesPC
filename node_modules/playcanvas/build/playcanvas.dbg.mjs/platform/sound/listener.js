import { Debug } from '../../core/debug.js';
import { Mat4 } from '../../core/math/mat4.js';
import { Vec3 } from '../../core/math/vec3.js';

/**
 * Represents an audio listener - used internally.
 *
 * @ignore
 */
class Listener {
  /**
   * Create a new listener instance.
   *
   * @param {import('./manager.js').SoundManager} manager - The sound manager.
   */
  constructor(manager) {
    /**
     * @type {import('./manager.js').SoundManager}
     * @private
     */
    this._manager = manager;

    /**
     * @type {Vec3}
     * @private
     */
    this.position = new Vec3();
    /**
     * @type {Vec3}
     * @private
     */
    this.velocity = new Vec3();
    /**
     * @type {Mat4}
     * @private
     */
    this.orientation = new Mat4();
  }

  /**
   * Get the position of the listener.
   *
   * @returns {Vec3} The position of the listener.
   */
  getPosition() {
    return this.position;
  }

  /**
   * Set the position of the listener.
   *
   * @param {Vec3} position - The new position of the listener.
   */
  setPosition(position) {
    this.position.copy(position);
    const listener = this.listener;
    if (listener) {
      if ('positionX' in listener) {
        listener.positionX.value = position.x;
        listener.positionY.value = position.y;
        listener.positionZ.value = position.z;
      } else if (listener.setPosition) {
        // Firefox (and legacy browsers)
        listener.setPosition(position.x, position.y, position.z);
      }
    }
  }

  /**
   * Get the velocity of the listener.
   *
   * @returns {Vec3} The velocity of the listener.
   * @deprecated
   */
  getVelocity() {
    Debug.warn('Listener#getVelocity is not implemented.');
    return this.velocity;
  }

  /**
   * Set the velocity of the listener.
   *
   * @param {Vec3} velocity - The new velocity of the listener.
   * @deprecated
   */
  setVelocity(velocity) {
    Debug.warn('Listener#setVelocity is not implemented.');
  }

  /**
   * Set the orientation matrix of the listener.
   *
   * @param {Mat4} orientation - The new orientation matrix of the listener.
   */
  setOrientation(orientation) {
    this.orientation.copy(orientation);
    const listener = this.listener;
    if (listener) {
      const m = orientation.data;
      if ('forwardX' in listener) {
        listener.forwardX.value = -m[8];
        listener.forwardY.value = -m[9];
        listener.forwardZ.value = -m[10];
        listener.upX.value = m[4];
        listener.upY.value = m[5];
        listener.upZ.value = m[6];
      } else if (listener.setOrientation) {
        // Firefox (and legacy browsers)
        listener.setOrientation(-m[8], -m[9], -m[10], m[4], m[5], m[6]);
      }
    }
  }

  /**
   * Get the orientation matrix of the listener.
   *
   * @returns {Mat4} The orientation matrix of the listener.
   */
  getOrientation() {
    return this.orientation;
  }

  /**
   * Get the listener.
   *
   * @type {AudioListener|null}
   */
  get listener() {
    const context = this._manager.context;
    return context ? context.listener : null;
  }
}

export { Listener };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGlzdGVuZXIuanMiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9wbGF0Zm9ybS9zb3VuZC9saXN0ZW5lci5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBEZWJ1ZyB9IGZyb20gJy4uLy4uL2NvcmUvZGVidWcuanMnO1xuaW1wb3J0IHsgTWF0NCB9IGZyb20gJy4uLy4uL2NvcmUvbWF0aC9tYXQ0LmpzJztcbmltcG9ydCB7IFZlYzMgfSBmcm9tICcuLi8uLi9jb3JlL21hdGgvdmVjMy5qcyc7XG5cbi8qKlxuICogUmVwcmVzZW50cyBhbiBhdWRpbyBsaXN0ZW5lciAtIHVzZWQgaW50ZXJuYWxseS5cbiAqXG4gKiBAaWdub3JlXG4gKi9cbmNsYXNzIExpc3RlbmVyIHtcbiAgICAvKipcbiAgICAgKiBDcmVhdGUgYSBuZXcgbGlzdGVuZXIgaW5zdGFuY2UuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge2ltcG9ydCgnLi9tYW5hZ2VyLmpzJykuU291bmRNYW5hZ2VyfSBtYW5hZ2VyIC0gVGhlIHNvdW5kIG1hbmFnZXIuXG4gICAgICovXG4gICAgY29uc3RydWN0b3IobWFuYWdlcikge1xuICAgICAgICAvKipcbiAgICAgICAgICogQHR5cGUge2ltcG9ydCgnLi9tYW5hZ2VyLmpzJykuU291bmRNYW5hZ2VyfVxuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5fbWFuYWdlciA9IG1hbmFnZXI7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEB0eXBlIHtWZWMzfVxuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5wb3NpdGlvbiA9IG5ldyBWZWMzKCk7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAdHlwZSB7VmVjM31cbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMudmVsb2NpdHkgPSBuZXcgVmVjMygpO1xuICAgICAgICAvKipcbiAgICAgICAgICogQHR5cGUge01hdDR9XG4gICAgICAgICAqIEBwcml2YXRlXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLm9yaWVudGF0aW9uID0gbmV3IE1hdDQoKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZXQgdGhlIHBvc2l0aW9uIG9mIHRoZSBsaXN0ZW5lci5cbiAgICAgKlxuICAgICAqIEByZXR1cm5zIHtWZWMzfSBUaGUgcG9zaXRpb24gb2YgdGhlIGxpc3RlbmVyLlxuICAgICAqL1xuICAgIGdldFBvc2l0aW9uKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5wb3NpdGlvbjtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBTZXQgdGhlIHBvc2l0aW9uIG9mIHRoZSBsaXN0ZW5lci5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7VmVjM30gcG9zaXRpb24gLSBUaGUgbmV3IHBvc2l0aW9uIG9mIHRoZSBsaXN0ZW5lci5cbiAgICAgKi9cbiAgICBzZXRQb3NpdGlvbihwb3NpdGlvbikge1xuICAgICAgICB0aGlzLnBvc2l0aW9uLmNvcHkocG9zaXRpb24pO1xuICAgICAgICBjb25zdCBsaXN0ZW5lciA9IHRoaXMubGlzdGVuZXI7XG4gICAgICAgIGlmIChsaXN0ZW5lcikge1xuICAgICAgICAgICAgaWYgKCdwb3NpdGlvblgnIGluIGxpc3RlbmVyKSB7XG4gICAgICAgICAgICAgICAgbGlzdGVuZXIucG9zaXRpb25YLnZhbHVlID0gcG9zaXRpb24ueDtcbiAgICAgICAgICAgICAgICBsaXN0ZW5lci5wb3NpdGlvblkudmFsdWUgPSBwb3NpdGlvbi55O1xuICAgICAgICAgICAgICAgIGxpc3RlbmVyLnBvc2l0aW9uWi52YWx1ZSA9IHBvc2l0aW9uLno7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGxpc3RlbmVyLnNldFBvc2l0aW9uKSB7IC8vIEZpcmVmb3ggKGFuZCBsZWdhY3kgYnJvd3NlcnMpXG4gICAgICAgICAgICAgICAgbGlzdGVuZXIuc2V0UG9zaXRpb24ocG9zaXRpb24ueCwgcG9zaXRpb24ueSwgcG9zaXRpb24ueik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZXQgdGhlIHZlbG9jaXR5IG9mIHRoZSBsaXN0ZW5lci5cbiAgICAgKlxuICAgICAqIEByZXR1cm5zIHtWZWMzfSBUaGUgdmVsb2NpdHkgb2YgdGhlIGxpc3RlbmVyLlxuICAgICAqIEBkZXByZWNhdGVkXG4gICAgICovXG4gICAgZ2V0VmVsb2NpdHkoKSB7XG4gICAgICAgIERlYnVnLndhcm4oJ0xpc3RlbmVyI2dldFZlbG9jaXR5IGlzIG5vdCBpbXBsZW1lbnRlZC4nKTtcbiAgICAgICAgcmV0dXJuIHRoaXMudmVsb2NpdHk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogU2V0IHRoZSB2ZWxvY2l0eSBvZiB0aGUgbGlzdGVuZXIuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge1ZlYzN9IHZlbG9jaXR5IC0gVGhlIG5ldyB2ZWxvY2l0eSBvZiB0aGUgbGlzdGVuZXIuXG4gICAgICogQGRlcHJlY2F0ZWRcbiAgICAgKi9cbiAgICBzZXRWZWxvY2l0eSh2ZWxvY2l0eSkge1xuICAgICAgICBEZWJ1Zy53YXJuKCdMaXN0ZW5lciNzZXRWZWxvY2l0eSBpcyBub3QgaW1wbGVtZW50ZWQuJyk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogU2V0IHRoZSBvcmllbnRhdGlvbiBtYXRyaXggb2YgdGhlIGxpc3RlbmVyLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtNYXQ0fSBvcmllbnRhdGlvbiAtIFRoZSBuZXcgb3JpZW50YXRpb24gbWF0cml4IG9mIHRoZSBsaXN0ZW5lci5cbiAgICAgKi9cbiAgICBzZXRPcmllbnRhdGlvbihvcmllbnRhdGlvbikge1xuICAgICAgICB0aGlzLm9yaWVudGF0aW9uLmNvcHkob3JpZW50YXRpb24pO1xuICAgICAgICBjb25zdCBsaXN0ZW5lciA9IHRoaXMubGlzdGVuZXI7XG4gICAgICAgIGlmIChsaXN0ZW5lcikge1xuICAgICAgICAgICAgY29uc3QgbSA9IG9yaWVudGF0aW9uLmRhdGE7XG4gICAgICAgICAgICBpZiAoJ2ZvcndhcmRYJyBpbiBsaXN0ZW5lcikge1xuICAgICAgICAgICAgICAgIGxpc3RlbmVyLmZvcndhcmRYLnZhbHVlID0gLW1bOF07XG4gICAgICAgICAgICAgICAgbGlzdGVuZXIuZm9yd2FyZFkudmFsdWUgPSAtbVs5XTtcbiAgICAgICAgICAgICAgICBsaXN0ZW5lci5mb3J3YXJkWi52YWx1ZSA9IC1tWzEwXTtcblxuICAgICAgICAgICAgICAgIGxpc3RlbmVyLnVwWC52YWx1ZSA9IG1bNF07XG4gICAgICAgICAgICAgICAgbGlzdGVuZXIudXBZLnZhbHVlID0gbVs1XTtcbiAgICAgICAgICAgICAgICBsaXN0ZW5lci51cFoudmFsdWUgPSBtWzZdO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChsaXN0ZW5lci5zZXRPcmllbnRhdGlvbikgeyAvLyBGaXJlZm94IChhbmQgbGVnYWN5IGJyb3dzZXJzKVxuICAgICAgICAgICAgICAgIGxpc3RlbmVyLnNldE9yaWVudGF0aW9uKC1tWzhdLCAtbVs5XSwgLW1bMTBdLCBtWzRdLCBtWzVdLCBtWzZdKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdldCB0aGUgb3JpZW50YXRpb24gbWF0cml4IG9mIHRoZSBsaXN0ZW5lci5cbiAgICAgKlxuICAgICAqIEByZXR1cm5zIHtNYXQ0fSBUaGUgb3JpZW50YXRpb24gbWF0cml4IG9mIHRoZSBsaXN0ZW5lci5cbiAgICAgKi9cbiAgICBnZXRPcmllbnRhdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMub3JpZW50YXRpb247XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0IHRoZSBsaXN0ZW5lci5cbiAgICAgKlxuICAgICAqIEB0eXBlIHtBdWRpb0xpc3RlbmVyfG51bGx9XG4gICAgICovXG4gICAgZ2V0IGxpc3RlbmVyKCkge1xuICAgICAgICBjb25zdCBjb250ZXh0ID0gdGhpcy5fbWFuYWdlci5jb250ZXh0O1xuICAgICAgICByZXR1cm4gY29udGV4dCA/IGNvbnRleHQubGlzdGVuZXIgOiBudWxsO1xuICAgIH1cbn1cblxuZXhwb3J0IHsgTGlzdGVuZXIgfTtcbiJdLCJuYW1lcyI6WyJMaXN0ZW5lciIsImNvbnN0cnVjdG9yIiwibWFuYWdlciIsIl9tYW5hZ2VyIiwicG9zaXRpb24iLCJWZWMzIiwidmVsb2NpdHkiLCJvcmllbnRhdGlvbiIsIk1hdDQiLCJnZXRQb3NpdGlvbiIsInNldFBvc2l0aW9uIiwiY29weSIsImxpc3RlbmVyIiwicG9zaXRpb25YIiwidmFsdWUiLCJ4IiwicG9zaXRpb25ZIiwieSIsInBvc2l0aW9uWiIsInoiLCJnZXRWZWxvY2l0eSIsIkRlYnVnIiwid2FybiIsInNldFZlbG9jaXR5Iiwic2V0T3JpZW50YXRpb24iLCJtIiwiZGF0YSIsImZvcndhcmRYIiwiZm9yd2FyZFkiLCJmb3J3YXJkWiIsInVwWCIsInVwWSIsInVwWiIsImdldE9yaWVudGF0aW9uIiwiY29udGV4dCJdLCJtYXBwaW5ncyI6Ijs7OztBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNQSxRQUFRLENBQUM7QUFDWDtBQUNKO0FBQ0E7QUFDQTtBQUNBO0VBQ0lDLFdBQVdBLENBQUNDLE9BQU8sRUFBRTtBQUNqQjtBQUNSO0FBQ0E7QUFDQTtJQUNRLElBQUksQ0FBQ0MsUUFBUSxHQUFHRCxPQUFPLENBQUE7O0FBRXZCO0FBQ1I7QUFDQTtBQUNBO0FBQ1EsSUFBQSxJQUFJLENBQUNFLFFBQVEsR0FBRyxJQUFJQyxJQUFJLEVBQUUsQ0FBQTtBQUMxQjtBQUNSO0FBQ0E7QUFDQTtBQUNRLElBQUEsSUFBSSxDQUFDQyxRQUFRLEdBQUcsSUFBSUQsSUFBSSxFQUFFLENBQUE7QUFDMUI7QUFDUjtBQUNBO0FBQ0E7QUFDUSxJQUFBLElBQUksQ0FBQ0UsV0FBVyxHQUFHLElBQUlDLElBQUksRUFBRSxDQUFBO0FBQ2pDLEdBQUE7O0FBRUE7QUFDSjtBQUNBO0FBQ0E7QUFD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
