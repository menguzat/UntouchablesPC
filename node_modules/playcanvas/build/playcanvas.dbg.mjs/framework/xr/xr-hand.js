import { EventHandler } from '../../core/event-handler.js';
import { platform } from '../../core/platform.js';
import { Vec3 } from '../../core/math/vec3.js';
import { XRHAND_LEFT } from './constants.js';
import { XrFinger } from './xr-finger.js';
import { XrJoint } from './xr-joint.js';

/**
 * @type {string[][]}
 * @ignore
 */
let fingerJointIds = [];
const vecA = new Vec3();
const vecB = new Vec3();
const vecC = new Vec3();
if (platform.browser && window.XRHand) {
  fingerJointIds = [['thumb-metacarpal', 'thumb-phalanx-proximal', 'thumb-phalanx-distal', 'thumb-tip'], ['index-finger-metacarpal', 'index-finger-phalanx-proximal', 'index-finger-phalanx-intermediate', 'index-finger-phalanx-distal', 'index-finger-tip'], ['middle-finger-metacarpal', 'middle-finger-phalanx-proximal', 'middle-finger-phalanx-intermediate', 'middle-finger-phalanx-distal', 'middle-finger-tip'], ['ring-finger-metacarpal', 'ring-finger-phalanx-proximal', 'ring-finger-phalanx-intermediate', 'ring-finger-phalanx-distal', 'ring-finger-tip'], ['pinky-finger-metacarpal', 'pinky-finger-phalanx-proximal', 'pinky-finger-phalanx-intermediate', 'pinky-finger-phalanx-distal', 'pinky-finger-tip']];
}

/**
 * Represents a hand with fingers and joints.
 *
 * @augments EventHandler
 */
class XrHand extends EventHandler {
  /**
   * Represents a hand with fingers and joints.
   *
   * @param {import('./xr-input-source.js').XrInputSource} inputSource - Input Source that hand
   * is related to.
   * @hideconstructor
   */
  constructor(inputSource) {
    super();
    /**
     * @type {import('./xr-manager.js').XrManager}
     * @private
     */
    this._manager = void 0;
    /**
     * @type {import('./xr-input-source.js').XrInputSource}
     * @private
     */
    this._inputSource = void 0;
    /**
     * @type {boolean}
     * @private
     */
    this._tracking = false;
    /**
     * @type {XrFinger[]}
     * @private
     */
    this._fingers = [];
    /**
     * @type {XrJoint[]}
     * @private
     */
    this._joints = [];
    /**
     * @type {Object<string, XrJoint>}
     * @private
     */
    this._jointsById = {};
    /**
     * @type {XrJoint[]}
     * @private
     */
    this._tips = [];
    /**
     * @type {XrJoint|null}
     * @private
     */
    this._wrist = null;
    const xrHand = inputSource._xrInputSource.hand;
    this._manager = inputSource._manager;
    this._inputSource = inputSource;
    if (xrHand.get('wrist')) {
      const joint = new XrJoint(0, 'wrist', this, null);
      this._wrist = joint;
      this._joints.push(joint);
      this._jointsById.wrist = joint;
    }
    for (let f = 0; f < fingerJointIds.length; f++) {
      const finger = new XrFinger(f, this);
      for (let j = 0; j < fingerJointIds[f].length; j++) {
        const jointId = fingerJointIds[f][j];
        if (!xrHand.get(jointId)) continue;
        const joint = new XrJoint(j, jointId, this, finger);
        this._joints.push(joint);
        this._jointsById[jointId] = joint;
        if (joint.tip) {
          this._tips.push(joint);
          finger._tip = joint;
        }
        finger._joints.push(joint);
      }
    }
  }

  /**
   * Fired when tracking becomes available.
   *
   * @event XrHand#tracking
   */

  /**
   * Fired when tracking is lost.
   *
   * @event XrHand#trackinglost
   */

  /**
   * @param {*} frame - XRFrame from requestAnimationFrame callback.
   * @ignore
   */
  update(frame) {
    const xrInputSource = this._inputSource._xrInputSource;

    // joints
    for (let j = 0; j < this._joints.length; j++) {
      const joint = this._joints[j];
      const jointSpace = xrInputSource.hand.get(joint._id);
      if (jointSpace) {
        let pose;
        if (frame.session.visibilityState !== 'hidden') pose = frame.getJointPose(jointSpace, this._manager._referenceSpace);
        if (pose) {
          joint.update(pose);
          if (joint.wrist && !this._tracking) {
            this._tracking = true;
            this.fire('tracking');
          }
        } else if (joint.wrist) {
          // lost tracking

          if (this._tracking) {
            this._tracking = false;
            this.fire('trackinglost');
          }
          break;
        }
      }
    }
    const j1 = this._jointsById['thumb-metacarpal'];
    const j4 = this._jointsById['thumb-tip'];
    const j6 = this._jointsById['index-finger-phalanx-proximal'];
    const j9 = this._jointsById['index-finger-tip'];
    const j16 = this._jointsById['ring-finger-phalanx-proximal'];
    const j21 = this._jointsById['pinky-finger-phalanx-proximal'];

    // ray
    if (j1 && j4 && j6 && j9 && j16 && j21) {
      this._inputSource._dirtyRay = true;

      // ray origin
      // get point between thumb tip and index tip
      this._inputSource._rayLocal.origin.lerp(j4._localPosition, j9._localPosition, 0.5);

      // ray direction
      let jointL = j1;
      let jointR = j21;
      if (this._inputSource.handedness === XRHAND_LEFT) {
        const t = jointL;
        jointL = jointR;
        jointR = t;
      }

      // (A) calculate normal vector between 3 joints: wrist, thumb metacarpal, little phalanx proximal
      vecA.sub2(jointL._localPosition, this._wrist._localPosition);
      vecB.sub2(jointR._localPosition, this._wrist._localPosition);
      vecC.cross(vecA, vecB).normalize();

      // get point between: index phalanx proximal and right phalanx proximal
      vecA.lerp(j6._localPosition, j16._localPosition, 0.5);
      // (B) get vector between that point and a wrist
      vecA.sub(this._wrist._localPosition).normalize();

      // mix normal vector (A) with hand directional vector (B)
      this._inputSource._rayLocal.direction.lerp(vecC, vecA, 0.5).normalize();
    }

    // emulate squeeze events by folding all 4 fingers
    const squeezing = this._fingerIsClosed(1) && this._fingerIsClosed(2) && this._fingerIsClosed(3) && this._fingerIsClosed(4);
    if (squeezing) {
      if (!this._inputSource._squeezing) {
        this._inputSource._squeezing = true;
        this._inputSource.fire('squeezestart');
        this._manager.input.fire('squeezestart', this._inputSource);
      }
    } else {
      if (this._inputSource._squeezing) {
        this._inputSource._squeezing = false;
        this._inputSource.fire('squeeze');
        this._manager.input.fire('squeeze', this._inputSource);
        this._inputSource.fire('squeezeend');
        this._manager.input.fire('squeezeend', this._inputSource);
      }
    }
  }

  /**
   * @param {number} index - Finger index.
   * @returns {boolean} True if finger is closed and false otherwise.
   * @private
   */
  _fingerIsClosed(index) {
    const finger = this._fingers[index];
    vecA.sub2(finger.joints[0]._localPosition, finger.joints[1]._localPosition).normalize();
    vecB.sub2(finger.joints[2]._localPosition, finger.joints[3]._localPosition).normalize();
    return vecA.dot(vecB) < -0.8;
  }

  /**
   * Returns joint by XRHand id from list in specs: https://immersive-web.github.io/webxr-hand-input/.
   *
   * @param {string} id - Id of a joint based on specs ID's in XRHand: https://immersive-web.github.io/webxr-hand-input/.
   * @returns {XrJoint|null} Joint or null if not available.
   */
  getJointById(id) {
    return this._jointsById[id] || null;
  }

  /**
   * List of fingers of a hand.
   *
   * @type {XrFinger[]}
   */
  get fingers() {
    return this._fingers;
  }

  /**
   * List of joints of hand.
   *
   * @type {XrJoint[]}
   */
  get joints() {
    return this._joints;
  }

  /**
   * List of joints that are fingertips.
   *
   * @type {XrJoint[]}
   */
  get tips() {
    return this._tips;
  }

  /**
   * Wrist of a hand, or null if it is not available by WebXR underlying system.
   *
   * @type {XrJoint|null}
   */
  get wrist() {
    return this._wrist;
  }

  /**
   * True if tracking is available, otherwise tracking might be lost.
   *
   * @type {boolean}
   */
  get tracking() {
    return this._tracking;
  }
}

export { XrHand };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoieHItaGFuZC5qcyIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL2ZyYW1ld29yay94ci94ci1oYW5kLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEV2ZW50SGFuZGxlciB9IGZyb20gJy4uLy4uL2NvcmUvZXZlbnQtaGFuZGxlci5qcyc7XG5pbXBvcnQgeyBwbGF0Zm9ybSB9IGZyb20gJy4uLy4uL2NvcmUvcGxhdGZvcm0uanMnO1xuaW1wb3J0IHsgVmVjMyB9IGZyb20gJy4uLy4uL2NvcmUvbWF0aC92ZWMzLmpzJztcblxuaW1wb3J0IHsgWFJIQU5EX0xFRlQgfSBmcm9tICcuL2NvbnN0YW50cy5qcyc7XG5pbXBvcnQgeyBYckZpbmdlciB9IGZyb20gJy4veHItZmluZ2VyLmpzJztcbmltcG9ydCB7IFhySm9pbnQgfSBmcm9tICcuL3hyLWpvaW50LmpzJztcblxuXG4vKipcbiAqIEB0eXBlIHtzdHJpbmdbXVtdfVxuICogQGlnbm9yZVxuICovXG5sZXQgZmluZ2VySm9pbnRJZHMgPSBbXTtcblxuY29uc3QgdmVjQSA9IG5ldyBWZWMzKCk7XG5jb25zdCB2ZWNCID0gbmV3IFZlYzMoKTtcbmNvbnN0IHZlY0MgPSBuZXcgVmVjMygpO1xuXG5pZiAocGxhdGZvcm0uYnJvd3NlciAmJiB3aW5kb3cuWFJIYW5kKSB7XG4gICAgZmluZ2VySm9pbnRJZHMgPSBbXG4gICAgICAgIFsndGh1bWItbWV0YWNhcnBhbCcsICd0aHVtYi1waGFsYW54LXByb3hpbWFsJywgJ3RodW1iLXBoYWxhbngtZGlzdGFsJywgJ3RodW1iLXRpcCddLFxuICAgICAgICBbJ2luZGV4LWZpbmdlci1tZXRhY2FycGFsJywgJ2luZGV4LWZpbmdlci1waGFsYW54LXByb3hpbWFsJywgJ2luZGV4LWZpbmdlci1waGFsYW54LWludGVybWVkaWF0ZScsICdpbmRleC1maW5nZXItcGhhbGFueC1kaXN0YWwnLCAnaW5kZXgtZmluZ2VyLXRpcCddLFxuICAgICAgICBbJ21pZGRsZS1maW5nZXItbWV0YWNhcnBhbCcsICdtaWRkbGUtZmluZ2VyLXBoYWxhbngtcHJveGltYWwnLCAnbWlkZGxlLWZpbmdlci1waGFsYW54LWludGVybWVkaWF0ZScsICdtaWRkbGUtZmluZ2VyLXBoYWxhbngtZGlzdGFsJywgJ21pZGRsZS1maW5nZXItdGlwJ10sXG4gICAgICAgIFsncmluZy1maW5nZXItbWV0YWNhcnBhbCcsICdyaW5nLWZpbmdlci1waGFsYW54LXByb3hpbWFsJywgJ3JpbmctZmluZ2VyLXBoYWxhbngtaW50ZXJtZWRpYXRlJywgJ3JpbmctZmluZ2VyLXBoYWxhbngtZGlzdGFsJywgJ3JpbmctZmluZ2VyLXRpcCddLFxuICAgICAgICBbJ3Bpbmt5LWZpbmdlci1tZXRhY2FycGFsJywgJ3Bpbmt5LWZpbmdlci1waGFsYW54LXByb3hpbWFsJywgJ3Bpbmt5LWZpbmdlci1waGFsYW54LWludGVybWVkaWF0ZScsICdwaW5reS1maW5nZXItcGhhbGFueC1kaXN0YWwnLCAncGlua3ktZmluZ2VyLXRpcCddXG4gICAgXTtcbn1cblxuLyoqXG4gKiBSZXByZXNlbnRzIGEgaGFuZCB3aXRoIGZpbmdlcnMgYW5kIGpvaW50cy5cbiAqXG4gKiBAYXVnbWVudHMgRXZlbnRIYW5kbGVyXG4gKi9cbmNsYXNzIFhySGFuZCBleHRlbmRzIEV2ZW50SGFuZGxlciB7XG4gICAgLyoqXG4gICAgICogQHR5cGUge2ltcG9ydCgnLi94ci1tYW5hZ2VyLmpzJykuWHJNYW5hZ2VyfVxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgX21hbmFnZXI7XG5cbiAgICAvKipcbiAgICAgKiBAdHlwZSB7aW1wb3J0KCcuL3hyLWlucHV0LXNvdXJjZS5qcycpLlhySW5wdXRTb3VyY2V9XG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBfaW5wdXRTb3VyY2U7XG5cbiAgICAvKipcbiAgICAgKiBAdHlwZSB7Ym9vbGVhbn1cbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIF90cmFja2luZyA9IGZhbHNlO1xuXG4gICAgLyoqXG4gICAgICogQHR5cGUge1hyRmluZ2VyW119XG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBfZmluZ2VycyA9IFtdO1xuXG4gICAgLyoqXG4gICAgICogQHR5cGUge1hySm9pbnRbXX1cbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIF9qb2ludHMgPSBbXTtcblxuICAgIC8qKlxuICAgICAqIEB0eXBlIHtPYmplY3Q8c3RyaW5nLCBYckpvaW50Pn1cbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIF9qb2ludHNCeUlkID0ge307XG5cbiAgICAvKipcbiAgICAgKiBAdHlwZSB7WHJKb2ludFtdfVxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgX3RpcHMgPSBbXTtcblxuICAgIC8qKlxuICAgICAqIEB0eXBlIHtYckpvaW50fG51bGx9XG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBfd3Jpc3QgPSBudWxsO1xuXG4gICAgLyoqXG4gICAgICogUmVwcmVzZW50cyBhIGhhbmQgd2l0aCBmaW5nZXJzIGFuZCBqb2ludHMuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge2ltcG9ydCgnLi94ci1pbnB1dC1zb3VyY2UuanMnKS5YcklucHV0U291cmNlfSBpbnB1dFNvdXJjZSAtIElucHV0IFNvdXJjZSB0aGF0IGhhbmRcbiAgICAgKiBpcyByZWxhdGVkIHRvLlxuICAgICAqIEBoaWRlY29uc3RydWN0b3JcbiAgICAgKi9cbiAgICBjb25zdHJ1Y3RvcihpbnB1dFNvdXJjZSkge1xuICAgICAgICBzdXBlcigpO1xuXG4gICAgICAgIGNvbnN0IHhySGFuZCA9IGlucHV0U291cmNlLl94cklucHV0U291cmNlLmhhbmQ7XG5cbiAgICAgICAgdGhpcy5fbWFuYWdlciA9IGlucHV0U291cmNlLl9tYW5hZ2VyO1xuICAgICAgICB0aGlzLl9pbnB1dFNvdXJjZSA9IGlucHV0U291cmNlO1xuXG4gICAgICAgIGlmICh4ckhhbmQuZ2V0KCd3cmlzdCcpKSB7XG4gICAgICAgICAgICBjb25zdCBqb2ludCA9IG5ldyBYckpvaW50KDAsICd3cmlzdCcsIHRoaXMsIG51bGwpO1xuICAgICAgICAgICAgdGhpcy5fd3Jpc3QgPSBqb2ludDtcbiAgICAgICAgICAgIHRoaXMuX2pvaW50cy5wdXNoKGpvaW50KTtcbiAgICAgICAgICAgIHRoaXMuX2pvaW50c0J5SWQud3Jpc3QgPSBqb2ludDtcbiAgICAgICAgfVxuXG4gICAgICAgIGZvciAobGV0IGYgPSAwOyBmIDwgZmluZ2VySm9pbnRJZHMubGVuZ3RoOyBmKyspIHtcbiAgICAgICAgICAgIGNvbnN0IGZpbmdlciA9IG5ldyBYckZpbmdlcihmLCB0aGlzKTtcblxuICAgICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBmaW5nZXJKb2ludElkc1tmXS5sZW5ndGg7IGorKykge1xuICAgICAgICAgICAgICAgIGNvbnN0IGpvaW50SWQgPSBmaW5nZXJKb2ludElkc1tmXVtqXTtcbiAgICAgICAgICAgICAgICBpZiAoIXhySGFuZC5nZXQoam9pbnRJZCkpIGNvbnRpbnVlO1xuXG4gICAgICAgICAgICAgICAgY29uc3Qgam9pbnQgPSBuZXcgWHJKb2ludChqLCBqb2ludElkLCB0aGlzLCBmaW5nZXIpO1xuXG4gICAgICAgICAgICAgICAgdGhpcy5fam9pbnRzLnB1c2goam9pbnQpO1xuICAgICAgICAgICAgICAgIHRoaXMuX2pvaW50c0J5SWRbam9pbnRJZF0gPSBqb2ludDtcbiAgICAgICAgICAgICAgICBpZiAoam9pbnQudGlwKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3RpcHMucHVzaChqb2ludCk7XG4gICAgICAgICAgICAgICAgICAgIGZpbmdlci5fdGlwID0gam9pbnQ7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgZmluZ2VyLl9qb2ludHMucHVzaChqb2ludCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBGaXJlZCB3aGVuIHRyYWNraW5nIGJlY29tZXMgYXZhaWxhYmxlLlxuICAgICAqXG4gICAgICogQGV2ZW50IFhySGFuZCN0cmFja2luZ1xuICAgICAqL1xuXG4gICAgLyoqXG4gICAgICogRmlyZWQgd2hlbiB0cmFja2luZyBpcyBsb3N0LlxuICAgICAqXG4gICAgICogQGV2ZW50IFhySGFuZCN0cmFja2luZ2xvc3RcbiAgICAgKi9cblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7Kn0gZnJhbWUgLSBYUkZyYW1lIGZyb20gcmVxdWVzdEFuaW1hdGlvbkZyYW1lIGNhbGxiYWNrLlxuICAgICAqIEBpZ25vcmVcbiAgICAgKi9cbiAgICB1cGRhdGUoZnJhbWUpIHtcbiAgICAgICAgY29uc3QgeHJJbnB1dFNvdXJjZSA9IHRoaXMuX2lucHV0U291cmNlLl94cklucHV0U291cmNlO1xuXG4gICAgICAgIC8vIGpvaW50c1xuICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IHRoaXMuX2pvaW50cy5sZW5ndGg7IGorKykge1xuICAgICAgICAgICAgY29uc3Qgam9pbnQgPSB0aGlzLl9qb2ludHNbal07XG4gICAgICAgICAgICBjb25zdCBqb2ludFNwYWNlID0geHJJbnB1dFNvdXJjZS5oYW5kLmdldChqb2ludC5faWQpO1xuICAgICAgICAgICAgaWYgKGpvaW50U3BhY2UpIHtcbiAgICAgICAgICAgICAgICBsZXQgcG9zZTtcblxuICAgICAgICAgICAgICAgIGlmIChmcmFtZS5zZXNzaW9uLnZpc2liaWxpdHlTdGF0ZSAhPT0gJ2hpZGRlbicpXG4gICAgICAgICAgICAgICAgICAgIHBvc2UgPSBmcmFtZS5nZXRKb2ludFBvc2Uoam9pbnRTcGFjZSwgdGhpcy5fbWFuYWdlci5fcmVmZXJlbmNlU3BhY2UpO1xuXG4gICAgICAgICAgICAgICAgaWYgKHBvc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgam9pbnQudXBkYXRlKHBvc2UpO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChqb2ludC53cmlzdCAmJiAhdGhpcy5fdHJhY2tpbmcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3RyYWNraW5nID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZmlyZSgndHJhY2tpbmcnKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoam9pbnQud3Jpc3QpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gbG9zdCB0cmFja2luZ1xuXG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLl90cmFja2luZykge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fdHJhY2tpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZmlyZSgndHJhY2tpbmdsb3N0Jyk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgajEgPSB0aGlzLl9qb2ludHNCeUlkWyd0aHVtYi1tZXRhY2FycGFsJ107XG4gICAgICAgIGNvbnN0IGo0ID0gdGhpcy5fam9pbnRzQnlJZFsndGh1bWItdGlwJ107XG4gICAgICAgIGNvbnN0IGo2ID0gdGhpcy5fam9pbnRzQnlJZFsnaW5kZXgtZmluZ2VyLXBoYWxhbngtcHJveGltYWwnXTtcbiAgICAgICAgY29uc3QgajkgPSB0aGlzLl9qb2ludHNCeUlkWydpbmRleC1maW5nZXItdGlwJ107XG4gICAgICAgIGNvbnN0IGoxNiA9IHRoaXMuX2pvaW50c0J5SWRbJ3JpbmctZmluZ2VyLXBoYWxhbngtcHJveGltYWwnXTtcbiAgICAgICAgY29uc3QgajIxID0gdGhpcy5fam9pbnRzQnlJZFsncGlua3ktZmluZ2VyLXBoYWxhbngtcHJveGltYWwnXTtcblxuICAgICAgICAvLyByYXlcbiAgICAgICAgaWYgKGoxICYmIGo0ICYmIGo2ICYmIGo5ICYmIGoxNiAmJiBqMjEpIHtcbiAgICAgICAgICAgIHRoaXMuX2lucHV0U291cmNlLl9kaXJ0eVJheSA9IHRydWU7XG5cbiAgICAgICAgICAgIC8vIHJheSBvcmlnaW5cbiAgICAgICAgICAgIC8vIGdldCBwb2ludCBiZXR3ZWVuIHRodW1iIHRpcCBhbmQgaW5kZXggdGlwXG4gICAgICAgICAgICB0aGlzLl9pbnB1dFNvdXJjZS5fcmF5TG9jYWwub3JpZ2luLmxlcnAoajQuX2xvY2FsUG9zaXRpb24sIGo5Ll9sb2NhbFBvc2l0aW9uLCAwLjUpO1xuXG4gICAgICAgICAgICAvLyByYXkgZGlyZWN0aW9uXG4gICAgICAgICAgICBsZXQgam9pbnRMID0gajE7XG4gICAgICAgICAgICBsZXQgam9pbnRSID0gajIxO1xuXG4gICAgICAgICAgICBpZiAodGhpcy5faW5wdXRTb3VyY2UuaGFuZGVkbmVzcyA9PT0gWFJIQU5EX0xFRlQpIHtcbiAgICAgICAgICAgICAgICBjb25zdCB0ID0gam9pbnRMO1xuICAgICAgICAgICAgICAgIGpvaW50TCA9IGpvaW50UjtcbiAgICAgICAgICAgICAgICBqb2ludFIgPSB0O1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyAoQSkgY2FsY3VsYXRlIG5vcm1hbCB2ZWN0b3IgYmV0d2VlbiAzIGpvaW50czogd3Jpc3QsIHRodW1iIG1ldGFjYXJwYWwsIGxpdHRsZSBwaGFsYW54IHByb3hpbWFsXG4gICAgICAgICAgICB2ZWNBLnN1YjIoam9pbnRMLl9sb2NhbFBvc2l0aW9uLCB0aGlzLl93cmlzdC5fbG9jYWxQb3NpdGlvbik7XG4gICAgICAgICAgICB2ZWNCLnN1YjIoam9pbnRSLl9sb2NhbFBvc2l0aW9uLCB0aGlzLl93cmlzdC5fbG9jYWxQb3NpdGlvbik7XG4gICAgICAgICAgICB2ZWNDLmNyb3NzKHZlY0EsIHZlY0IpLm5vcm1hbGl6ZSgpO1xuXG4gICAgICAgICAgICAvLyBnZXQgcG9pbnQgYmV0d2VlbjogaW5kZXggcGhhbGFueCBwcm94aW1hbCBhbmQgcmlnaHQgcGhhbGFueCBwcm94aW1hbFxuICAgICAgICAgICAgdmVjQS5sZXJwKGo2Ll9sb2NhbFBvc2l0aW9uLCBqMTYuX2xvY2FsUG9zaXRpb24sIDAuNSk7XG4gICAgICAgICAgICAvLyAoQikgZ2V0IHZlY3RvciBiZXR3ZWVuIHRoYXQgcG9pbnQgYW5kIGEgd3Jpc3RcbiAgICAgICAgICAgIHZlY0Euc3ViKHRoaXMuX3dyaXN0Ll9sb2NhbFBvc2l0aW9uKS5ub3JtYWxpemUoKTtcblxuICAgICAgICAgICAgLy8gbWl4IG5vcm1hbCB2ZWN0b3IgKEEpIHdpdGggaGFuZCBkaXJlY3Rpb25hbCB2ZWN0b3IgKEIpXG4gICAgICAgICAgICB0aGlzLl9pbnB1dFNvdXJjZS5fcmF5TG9jYWwuZGlyZWN0aW9uLmxlcnAodmVjQywgdmVjQSwgMC41KS5ub3JtYWxpemUoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIGVtdWxhdGUgc3F1ZWV6ZSBldmVudHMgYnkgZm9sZGluZyBhbGwgNCBmaW5nZXJzXG4gICAgICAgIGNvbnN0IHNxdWVlemluZyA9IHRoaXMuX2ZpbmdlcklzQ2xvc2VkKDEpICYmIHRoaXMuX2ZpbmdlcklzQ2xvc2VkKDIpICYmIHRoaXMuX2ZpbmdlcklzQ2xvc2VkKDMpICYmIHRoaXMuX2ZpbmdlcklzQ2xvc2VkKDQpO1xuXG4gICAgICAgIGlmIChzcXVlZXppbmcpIHtcbiAgICAgICAgICAgIGlmICghdGhpcy5faW5wdXRTb3VyY2UuX3NxdWVlemluZykge1xuICAgICAgICAgICAgICAgIHRoaXMuX2lucHV0U291cmNlLl9zcXVlZXppbmcgPSB0cnVlO1xuICAgICAgICAgICAgICAgIHRoaXMuX2lucHV0U291cmNlLmZpcmUoJ3NxdWVlemVzdGFydCcpO1xuICAgICAgICAgICAgICAgIHRoaXMuX21hbmFnZXIuaW5wdXQuZmlyZSgnc3F1ZWV6ZXN0YXJ0JywgdGhpcy5faW5wdXRTb3VyY2UpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaWYgKHRoaXMuX2lucHV0U291cmNlLl9zcXVlZXppbmcpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9pbnB1dFNvdXJjZS5fc3F1ZWV6aW5nID0gZmFsc2U7XG5cbiAgICAgICAgICAgICAgICB0aGlzLl9pbnB1dFNvdXJjZS5maXJlKCdzcXVlZXplJyk7XG4gICAgICAgICAgICAgICAgdGhpcy5fbWFuYWdlci5pbnB1dC5maXJlKCdzcXVlZXplJywgdGhpcy5faW5wdXRTb3VyY2UpO1xuXG4gICAgICAgICAgICAgICAgdGhpcy5faW5wdXRTb3VyY2UuZmlyZSgnc3F1ZWV6ZWVuZCcpO1xuICAgICAgICAgICAgICAgIHRoaXMuX21hbmFnZXIuaW5wdXQuZmlyZSgnc3F1ZWV6ZWVuZCcsIHRoaXMuX2lucHV0U291cmNlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBpbmRleCAtIEZpbmdlciBpbmRleC5cbiAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gVHJ1ZSBpZiBmaW5nZXIgaXMgY2xvc2VkIGFuZCBmYWxzZSBvdGhlcndpc2UuXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBfZmluZ2VySXNDbG9zZWQoaW5kZXgpIHtcbiAgICAgICAgY29uc3QgZmluZ2VyID0gdGhpcy5fZmluZ2Vyc1tpbmRleF07XG4gICAgICAgIHZlY0Euc3ViMihmaW5nZXIuam9pbnRzWzBdLl9sb2NhbFBvc2l0aW9uLCBmaW5nZXIuam9pbnRzWzFdLl9sb2NhbFBvc2l0aW9uKS5ub3JtYWxpemUoKTtcbiAgICAgICAgdmVjQi5zdWIyKGZpbmdlci5qb2ludHNbMl0uX2xvY2FsUG9zaXRpb24sIGZpbmdlci5qb2ludHNbM10uX2xvY2FsUG9zaXRpb24pLm5vcm1hbGl6ZSgpO1xuICAgICAgICByZXR1cm4gdmVjQS5kb3QodmVjQikgPCAtMC44O1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJldHVybnMgam9pbnQgYnkgWFJIYW5kIGlkIGZyb20gbGlzdCBpbiBzcGVjczogaHR0cHM6Ly9pbW1lcnNpdmUtd2ViLmdpdGh1Yi5pby93ZWJ4ci1oYW5kLWlucHV0Ly5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBpZCAtIElkIG9mIGEgam9pbnQgYmFzZWQgb24gc3BlY3MgSUQncyBpbiBYUkhhbmQ6IGh0dHBzOi8vaW1tZXJzaXZlLXdlYi5naXRodWIuaW8vd2VieHItaGFuZC1pbnB1dC8uXG4gICAgICogQHJldHVybnMge1hySm9pbnR8bnVsbH0gSm9pbnQgb3IgbnVsbCBpZiBub3QgYXZhaWxhYmxlLlxuICAgICAqL1xuICAgIGdldEpvaW50QnlJZChpZCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fam9pbnRzQnlJZFtpZF0gfHwgbnVsbDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBMaXN0IG9mIGZpbmdlcnMgb2YgYSBoYW5kLlxuICAgICAqXG4gICAgICogQHR5cGUge1hyRmluZ2VyW119XG4gICAgICovXG4gICAgZ2V0IGZpbmdlcnMoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9maW5nZXJzO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIExpc3Qgb2Ygam9pbnRzIG9mIGhhbmQuXG4gICAgICpcbiAgICAgKiBAdHlwZSB7WHJKb2ludFtdfVxuICAgICAqL1xuICAgIGdldCBqb2ludHMoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9qb2ludHM7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogTGlzdCBvZiBqb2ludHMgdGhhdCBhcmUgZmluZ2VydGlwcy5cbiAgICAgKlxuICAgICAqIEB0eXBlIHtYckpvaW50W119XG4gICAgICovXG4gICAgZ2V0IHRpcHMoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl90aXBzO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFdyaXN0IG9mIGEgaGFuZCwgb3IgbnVsbCBpZiBpdCBpcyBub3QgYXZhaWxhYmxlIGJ5IFdlYlhSIHVuZGVybHlpbmcgc3lzdGVtLlxuICAgICAqXG4gICAgICogQHR5cGUge1hySm9pbnR8bnVsbH1cbiAgICAgKi9cbiAgICBnZXQgd3Jpc3QoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl93cmlzdDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUcnVlIGlmIHRyYWNraW5nIGlzIGF2YWlsYWJsZSwgb3RoZXJ3aXNlIHRyYWNraW5nIG1pZ2h0IGJlIGxvc3QuXG4gICAgICpcbiAgICAgKiBAdHlwZSB7Ym9vbGVhbn1cbiAgICAgKi9cbiAgICBnZXQgdHJhY2tpbmcoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl90cmFja2luZztcbiAgICB9XG59XG5cbmV4cG9ydCB7IFhySGFuZCB9O1xuIl0sIm5hbWVzIjpbImZpbmdlckpvaW50SWRzIiwidmVjQSIsIlZlYzMiLCJ2ZWNCIiwidmVjQyIsInBsYXRmb3JtIiwiYnJvd3NlciIsIndpbmRvdyIsIlhSSGFuZCIsIlhySGFuZCIsIkV2ZW50SGFuZGxlciIsImNvbnN0cnVjdG9yIiwiaW5wdXRTb3VyY2UiLCJfbWFuYWdlciIsIl9pbnB1dFNvdXJjZSIsIl90cmFja2luZyIsIl9maW5nZXJzIiwiX2pvaW50cyIsIl9qb2ludHNCeUlkIiwiX3RpcHMiLCJfd3Jpc3QiLCJ4ckhhbmQiLCJfeHJJbnB1dFNvdXJjZSIsImhhbmQiLCJnZXQiLCJqb2ludCIsIlhySm9pbnQiLCJwdXNoIiwid3Jpc3QiLCJmIiwibGVuZ3RoIiwiZmluZ2VyIiwiWHJGaW5nZXIiLCJqIiwiam9pbnRJZCIsInRpcCIsIl90aXAiLCJ1cGRhdGUiLCJmcmFtZSIsInhySW5wdXRTb3VyY2UiLCJqb2ludFNwYWNlIiwiX2lkIiwicG9zZSIsInNlc3Npb24iLCJ2aXNpYmlsaXR5U3RhdGUiLCJnZXRKb2ludFBvc2UiLCJfcmVmZXJlbmNlU3BhY2UiLCJmaXJlIiwiajEiLCJqNCIsImo2IiwiajkiLCJqMTYiLCJqMjEiLCJfZGlydHlSYXkiLCJfcmF5TG9jYWwiLCJvcmlnaW4iLCJsZXJwIiwiX2xvY2FsUG9zaXRpb24iLCJqb2ludEwiLCJqb2ludFIiLCJoYW5kZWRuZXNzIiwiWFJIQU5EX0xFRlQiLCJ0Iiwic3ViMiIsImNyb3NzIiwibm9ybWFsaXplIiwic3ViIiwiZGlyZWN0aW9uIiwic3F1ZWV6aW5nIiwiX2ZpbmdlcklzQ2xvc2VkIiwiX3NxdWVlemluZyIsImlucHV0IiwiaW5kZXgiLCJqb2ludHMiLCJkb3QiLCJnZXRKb2ludEJ5SWQiLCJpZCIsImZpbmdlcnMiLCJ0aXBzIiwidHJhY2tpbmciXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFTQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUlBLGNBQWMsR0FBRyxFQUFFLENBQUE7QUFFdkIsTUFBTUMsSUFBSSxHQUFHLElBQUlDLElBQUksRUFBRSxDQUFBO0FBQ3ZCLE1BQU1DLElBQUksR0FBRyxJQUFJRCxJQUFJLEVBQUUsQ0FBQTtBQUN2QixNQUFNRSxJQUFJLEdBQUcsSUFBSUYsSUFBSSxFQUFFLENBQUE7QUFFdkIsSUFBSUcsUUFBUSxDQUFDQyxPQUFPLElBQUlDLE1BQU0sQ0FBQ0MsTUFBTSxFQUFFO0VBQ25DUixjQUFjLEdBQUcsQ0FDYixDQUFDLGtCQUFrQixFQUFFLHdCQUF3QixFQUFFLHNCQUFzQixFQUFFLFdBQVcsQ0FBQyxFQUNuRixDQUFDLHlCQUF5QixFQUFFLCtCQUErQixFQUFFLG1DQUFtQyxFQUFFLDZCQUE2QixFQUFFLGtCQUFrQixDQUFDLEVBQ3BKLENBQUMsMEJBQTBCLEVBQUUsZ0NBQWdDLEVBQUUsb0NBQW9DLEVBQUUsOEJBQThCLEVBQUUsbUJBQW1CLENBQUMsRUFDekosQ0FBQyx3QkFBd0IsRUFBRSw4QkFBOEIsRUFBRSxrQ0FBa0MsRUFBRSw0QkFBNEIsRUFBRSxpQkFBaUIsQ0FBQyxFQUMvSSxDQUFDLHlCQUF5QixFQUFFLCtCQUErQixFQUFFLG1DQUFtQyxFQUFFLDZCQUE2QixFQUFFLGtCQUFrQixDQUFDLENBQ3ZKLENBQUE7QUFDTCxDQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNUyxNQUFNLFNBQVNDLFlBQVksQ0FBQztBQWlEOUI7QUFDSjtBQUNBO0FBQ0E7QUFDQTtB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
