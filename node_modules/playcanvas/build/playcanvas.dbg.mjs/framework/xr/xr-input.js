import { EventHandler } from '../../core/event-handler.js';
import { XrInputSource } from './xr-input-source.js';

/**
 * Provides access to input sources for WebXR.
 *
 * @augments EventHandler
 */
class XrInput extends EventHandler {
  /**
   * Create a new XrInput instance.
   *
   * @param {import('./xr-manager.js').XrManager} manager - WebXR Manager.
   * @hideconstructor
   */
  constructor(manager) {
    super();
    /**
     * @type {import('./xr-manager.js').XrManager}
     * @private
     */
    this.manager = void 0;
    /**
     * @type {XrInputSource[]}
     * @private
     */
    this._inputSources = [];
    /**
     * @type {Function}
     * @private
     */
    this._onInputSourcesChangeEvt = void 0;
    this.manager = manager;
    this._onInputSourcesChangeEvt = evt => {
      this._onInputSourcesChange(evt);
    };
    this.manager.on('start', this._onSessionStart, this);
    this.manager.on('end', this._onSessionEnd, this);
  }

  /**
   * Fired when new {@link XrInputSource} is added to the list.
   *
   * @event XrInput#add
   * @param {XrInputSource} inputSource - Input source that has been added.
   * @example
   * app.xr.input.on('add', function (inputSource) {
   *     // new input source is added
   * });
   */

  /**
   * Fired when {@link XrInputSource} is removed to the list.
   *
   * @event XrInput#remove
   * @param {XrInputSource} inputSource - Input source that has been removed.
   * @example
   * app.xr.input.on('remove', function (inputSource) {
   *     // input source is removed
   * });
   */

  /**
   * Fired when {@link XrInputSource} has triggered primary action. This could be pressing a
   * trigger button, or touching a screen.
   *
   * @event XrInput#select
   * @param {XrInputSource} inputSource - Input source that triggered select event.
   * @param {object} evt - XRInputSourceEvent event data from WebXR API.
   * @example
   * const ray = new pc.Ray();
   * app.xr.input.on('select', function (inputSource, evt) {
   *     ray.set(inputSource.getOrigin(), inputSource.getDirection());
   *     if (obj.intersectsRay(ray)) {
   *         // selected an object with input source
   *     }
   * });
   */

  /**
   * Fired when {@link XrInputSource} has started to trigger primary action.
   *
   * @event XrInput#selectstart
   * @param {XrInputSource} inputSource - Input source that triggered selectstart event.
   * @param {object} evt - XRInputSourceEvent event data from WebXR API.
   */

  /**
   * Fired when {@link XrInputSource} has ended triggerring primary action.
   *
   * @event XrInput#selectend
   * @param {XrInputSource} inputSource - Input source that triggered selectend event.
   * @param {object} evt - XRInputSourceEvent event data from WebXR API.
   */

  /**
   * Fired when {@link XrInputSource} has triggered squeeze action. This is associated with
   * "grabbing" action on the controllers.
   *
   * @event XrInput#squeeze
   * @param {XrInputSource} inputSource - Input source that triggered squeeze event.
   * @param {object} evt - XRInputSourceEvent event data from WebXR API.
   */

  /**
   * Fired when {@link XrInputSource} has started to trigger sqeeze action.
   *
   * @event XrInput#squeezestart
   * @param {XrInputSource} inputSource - Input source that triggered squeezestart event.
   * @param {object} evt - XRInputSourceEvent event data from WebXR API.
   * @example
   * app.xr.input.on('squeezestart', function (inputSource, evt) {
   *     if (obj.containsPoint(inputSource.getPosition())) {
   *         // grabbed an object
   *     }
   * });
   */

  /**
   * Fired when {@link XrInputSource} has ended triggerring sqeeze action.
   *
   * @event XrInput#squeezeend
   * @param {XrInputSource} inputSource - Input source that triggered squeezeend event.
   * @param {object} evt - XRInputSourceEvent event data from WebXR API.
   */

  /** @private */
  _onSessionStart() {
    const session = this.manager.session;
    session.addEventListener('inputsourceschange', this._onInputSourcesChangeEvt);
    session.addEventListener('select', evt => {
      const inputSource = this._getByInputSource(evt.inputSource);
      inputSource.update(evt.frame);
      inputSource.fire('select', evt);
      this.fire('select', inputSource, evt);
    });
    session.addEventListener('selectstart', evt => {
      const inputSource = this._getByInputSource(evt.inputSource);
      inputSource.update(evt.frame);
      inputSource._selecting = true;
      inputSource.fire('selectstart', evt);
      this.fire('selectstart', inputSource, evt);
    });
    session.addEventListener('selectend', evt => {
      const inputSource = this._getByInputSource(evt.inputSource);
      inputSource.update(evt.frame);
      inputSource._selecting = false;
      inputSource.fire('selectend', evt);
      this.fire('selectend', inputSource, evt);
    });
    session.addEventListener('squeeze', evt => {
      const inputSource = this._getByInputSource(evt.inputSource);
      inputSource.update(evt.frame);
      inputSource.fire('squeeze', evt);
      this.fire('squeeze', inputSource, evt);
    });
    session.addEventListener('squeezestart', evt => {
      const inputSource = this._getByInputSource(evt.inputSource);
      inputSource.update(evt.frame);
      inputSource._squeezing = true;
      inputSource.fire('squeezestart', evt);
      this.fire('squeezestart', inputSource, evt);
    });
    session.addEventListener('squeezeend', evt => {
      const inputSource = this._getByInputSource(evt.inputSource);
      inputSource.update(evt.frame);
      inputSource._squeezing = false;
      inputSource.fire('squeezeend', evt);
      this.fire('squeezeend', inputSource, evt);
    });

    // add input sources
    const inputSources = session.inputSources;
    for (let i = 0; i < inputSources.length; i++) {
      this._addInputSource(inputSources[i]);
    }
  }

  /** @private */
  _onSessionEnd() {
    let i = this._inputSources.length;
    while (i--) {
      const inputSource = this._inputSources[i];
      this._inputSources.splice(i, 1);
      inputSource.fire('remove');
      this.fire('remove', inputSource);
    }
    const session = this.manager.session;
    session.removeEventListener('inputsourceschange', this._onInputSourcesChangeEvt);
  }

  /**
   * @param {XRInputSourcesChangeEvent} evt - WebXR input sources change event.
   * @private
   */
  _onInputSourcesChange(evt) {
    // remove
    for (let i = 0; i < evt.removed.length; i++) {
      this._removeInputSource(evt.removed[i]);
    }

    // add
    for (let i = 0; i < evt.added.length; i++) {
      this._addInputSource(evt.added[i]);
    }
  }

  /**
   * @param {XRInputSource} xrInputSource - Input source to search for.
   * @returns {XrInputSource|null} The input source that matches the given WebXR input source or
   * null if no match is found.
   * @private
   */
  _getByInputSource(xrInputSource) {
    for (let i = 0; i < this._inputSources.length; i++) {
      if (this._inputSources[i].inputSource === xrInputSource) {
        return this._inputSources[i];
      }
    }
    return null;
  }

  /**
   * @param {XRInputSource} xrInputSource - Input source to add.
   * @private
   */
  _addInputSource(xrInputSource) {
    if (this._getByInputSource(xrInputSource)) return;
    const inputSource = new XrInputSource(this.manager, xrInputSource);
    this._inputSources.push(inputSource);
    this.fire('add', inputSource);
  }

  /**
   * @param {XRInputSource} xrInputSource - Input source to remove.
   * @private
   */
  _removeInputSource(xrInputSource) {
    for (let i = 0; i < this._inputSources.length; i++) {
      if (this._inputSources[i].inputSource !== xrInputSource) continue;
      const inputSource = this._inputSources[i];
      this._inputSources.splice(i, 1);
      let h = inputSource.hitTestSources.length;
      while (h--) {
        inputSource.hitTestSources[h].remove();
      }
      inputSource.fire('remove');
      this.fire('remove', inputSource);
      return;
    }
  }

  /**
   * @param {*} frame - XRFrame from requestAnimationFrame callback.
   * @ignore
   */
  update(frame) {
    for (let i = 0; i < this._inputSources.length; i++) {
      this._inputSources[i].update(frame);
    }
  }

  /**
   * List of active {@link XrInputSource} instances.
   *
   * @type {XrInputSource[]}
   */
  get inputSources() {
    return this._inputSources;
  }
}

export { XrInput };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoieHItaW5wdXQuanMiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9mcmFtZXdvcmsveHIveHItaW5wdXQuanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRXZlbnRIYW5kbGVyIH0gZnJvbSAnLi4vLi4vY29yZS9ldmVudC1oYW5kbGVyLmpzJztcblxuaW1wb3J0IHsgWHJJbnB1dFNvdXJjZSB9IGZyb20gJy4veHItaW5wdXQtc291cmNlLmpzJztcblxuLyoqXG4gKiBQcm92aWRlcyBhY2Nlc3MgdG8gaW5wdXQgc291cmNlcyBmb3IgV2ViWFIuXG4gKlxuICogQGF1Z21lbnRzIEV2ZW50SGFuZGxlclxuICovXG5jbGFzcyBYcklucHV0IGV4dGVuZHMgRXZlbnRIYW5kbGVyIHtcbiAgICAvKipcbiAgICAgKiBAdHlwZSB7aW1wb3J0KCcuL3hyLW1hbmFnZXIuanMnKS5Yck1hbmFnZXJ9XG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBtYW5hZ2VyO1xuXG4gICAgLyoqXG4gICAgICogQHR5cGUge1hySW5wdXRTb3VyY2VbXX1cbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIF9pbnB1dFNvdXJjZXMgPSBbXTtcblxuICAgIC8qKlxuICAgICAqIEB0eXBlIHtGdW5jdGlvbn1cbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIF9vbklucHV0U291cmNlc0NoYW5nZUV2dDtcblxuICAgIC8qKlxuICAgICAqIENyZWF0ZSBhIG5ldyBYcklucHV0IGluc3RhbmNlLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtpbXBvcnQoJy4veHItbWFuYWdlci5qcycpLlhyTWFuYWdlcn0gbWFuYWdlciAtIFdlYlhSIE1hbmFnZXIuXG4gICAgICogQGhpZGVjb25zdHJ1Y3RvclxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKG1hbmFnZXIpIHtcbiAgICAgICAgc3VwZXIoKTtcblxuICAgICAgICB0aGlzLm1hbmFnZXIgPSBtYW5hZ2VyO1xuXG4gICAgICAgIHRoaXMuX29uSW5wdXRTb3VyY2VzQ2hhbmdlRXZ0ID0gKGV2dCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5fb25JbnB1dFNvdXJjZXNDaGFuZ2UoZXZ0KTtcbiAgICAgICAgfTtcblxuICAgICAgICB0aGlzLm1hbmFnZXIub24oJ3N0YXJ0JywgdGhpcy5fb25TZXNzaW9uU3RhcnQsIHRoaXMpO1xuICAgICAgICB0aGlzLm1hbmFnZXIub24oJ2VuZCcsIHRoaXMuX29uU2Vzc2lvbkVuZCwgdGhpcyk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRmlyZWQgd2hlbiBuZXcge0BsaW5rIFhySW5wdXRTb3VyY2V9IGlzIGFkZGVkIHRvIHRoZSBsaXN0LlxuICAgICAqXG4gICAgICogQGV2ZW50IFhySW5wdXQjYWRkXG4gICAgICogQHBhcmFtIHtYcklucHV0U291cmNlfSBpbnB1dFNvdXJjZSAtIElucHV0IHNvdXJjZSB0aGF0IGhhcyBiZWVuIGFkZGVkLlxuICAgICAqIEBleGFtcGxlXG4gICAgICogYXBwLnhyLmlucHV0Lm9uKCdhZGQnLCBmdW5jdGlvbiAoaW5wdXRTb3VyY2UpIHtcbiAgICAgKiAgICAgLy8gbmV3IGlucHV0IHNvdXJjZSBpcyBhZGRlZFxuICAgICAqIH0pO1xuICAgICAqL1xuXG4gICAgLyoqXG4gICAgICogRmlyZWQgd2hlbiB7QGxpbmsgWHJJbnB1dFNvdXJjZX0gaXMgcmVtb3ZlZCB0byB0aGUgbGlzdC5cbiAgICAgKlxuICAgICAqIEBldmVudCBYcklucHV0I3JlbW92ZVxuICAgICAqIEBwYXJhbSB7WHJJbnB1dFNvdXJjZX0gaW5wdXRTb3VyY2UgLSBJbnB1dCBzb3VyY2UgdGhhdCBoYXMgYmVlbiByZW1vdmVkLlxuICAgICAqIEBleGFtcGxlXG4gICAgICogYXBwLnhyLmlucHV0Lm9uKCdyZW1vdmUnLCBmdW5jdGlvbiAoaW5wdXRTb3VyY2UpIHtcbiAgICAgKiAgICAgLy8gaW5wdXQgc291cmNlIGlzIHJlbW92ZWRcbiAgICAgKiB9KTtcbiAgICAgKi9cblxuICAgIC8qKlxuICAgICAqIEZpcmVkIHdoZW4ge0BsaW5rIFhySW5wdXRTb3VyY2V9IGhhcyB0cmlnZ2VyZWQgcHJpbWFyeSBhY3Rpb24uIFRoaXMgY291bGQgYmUgcHJlc3NpbmcgYVxuICAgICAqIHRyaWdnZXIgYnV0dG9uLCBvciB0b3VjaGluZyBhIHNjcmVlbi5cbiAgICAgKlxuICAgICAqIEBldmVudCBYcklucHV0I3NlbGVjdFxuICAgICAqIEBwYXJhbSB7WHJJbnB1dFNvdXJjZX0gaW5wdXRTb3VyY2UgLSBJbnB1dCBzb3VyY2UgdGhhdCB0cmlnZ2VyZWQgc2VsZWN0IGV2ZW50LlxuICAgICAqIEBwYXJhbSB7b2JqZWN0fSBldnQgLSBYUklucHV0U291cmNlRXZlbnQgZXZlbnQgZGF0YSBmcm9tIFdlYlhSIEFQSS5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqIGNvbnN0IHJheSA9IG5ldyBwYy5SYXkoKTtcbiAgICAgKiBhcHAueHIuaW5wdXQub24oJ3NlbGVjdCcsIGZ1bmN0aW9uIChpbnB1dFNvdXJjZSwgZXZ0KSB7XG4gICAgICogICAgIHJheS5zZXQoaW5wdXRTb3VyY2UuZ2V0T3JpZ2luKCksIGlucHV0U291cmNlLmdldERpcmVjdGlvbigpKTtcbiAgICAgKiAgICAgaWYgKG9iai5pbnRlcnNlY3RzUmF5KHJheSkpIHtcbiAgICAgKiAgICAgICAgIC8vIHNlbGVjdGVkIGFuIG9iamVjdCB3aXRoIGlucHV0IHNvdXJjZVxuICAgICAqICAgICB9XG4gICAgICogfSk7XG4gICAgICovXG5cbiAgICAvKipcbiAgICAgKiBGaXJlZCB3aGVuIHtAbGluayBYcklucHV0U291cmNlfSBoYXMgc3RhcnRlZCB0byB0cmlnZ2VyIHByaW1hcnkgYWN0aW9uLlxuICAgICAqXG4gICAgICogQGV2ZW50IFhySW5wdXQjc2VsZWN0c3RhcnRcbiAgICAgKiBAcGFyYW0ge1hySW5wdXRTb3VyY2V9IGlucHV0U291cmNlIC0gSW5wdXQgc291cmNlIHRoYXQgdHJpZ2dlcmVkIHNlbGVjdHN0YXJ0IGV2ZW50LlxuICAgICAqIEBwYXJhbSB7b2JqZWN0fSBldnQgLSBYUklucHV0U291cmNlRXZlbnQgZXZlbnQgZGF0YSBmcm9tIFdlYlhSIEFQSS5cbiAgICAgKi9cblxuICAgIC8qKlxuICAgICAqIEZpcmVkIHdoZW4ge0BsaW5rIFhySW5wdXRTb3VyY2V9IGhhcyBlbmRlZCB0cmlnZ2VycmluZyBwcmltYXJ5IGFjdGlvbi5cbiAgICAgKlxuICAgICAqIEBldmVudCBYcklucHV0I3NlbGVjdGVuZFxuICAgICAqIEBwYXJhbSB7WHJJbnB1dFNvdXJjZX0gaW5wdXRTb3VyY2UgLSBJbnB1dCBzb3VyY2UgdGhhdCB0cmlnZ2VyZWQgc2VsZWN0ZW5kIGV2ZW50LlxuICAgICAqIEBwYXJhbSB7b2JqZWN0fSBldnQgLSBYUklucHV0U291cmNlRXZlbnQgZXZlbnQgZGF0YSBmcm9tIFdlYlhSIEFQSS5cbiAgICAgKi9cblxuICAgIC8qKlxuICAgICAqIEZpcmVkIHdoZW4ge0BsaW5rIFhySW5wdXRTb3VyY2V9IGhhcyB0cmlnZ2VyZWQgc3F1ZWV6ZSBhY3Rpb24uIFRoaXMgaXMgYXNzb2NpYXRlZCB3aXRoXG4gICAgICogXCJncmFiYmluZ1wiIGFjdGlvbiBvbiB0aGUgY29udHJvbGxlcnMuXG4gICAgICpcbiAgICAgKiBAZXZlbnQgWHJJbnB1dCNzcXVlZXplXG4gICAgICogQHBhcmFtIHtYcklucHV0U291cmNlfSBpbnB1dFNvdXJjZSAtIElucHV0IHNvdXJjZSB0aGF0IHRyaWdnZXJlZCBzcXVlZXplIGV2ZW50LlxuICAgICAqIEBwYXJhbSB7b2JqZWN0fSBldnQgLSBYUklucHV0U291cmNlRXZlbnQgZXZlbnQgZGF0YSBmcm9tIFdlYlhSIEFQSS5cbiAgICAgKi9cblxuICAgIC8qKlxuICAgICAqIEZpcmVkIHdoZW4ge0BsaW5rIFhySW5wdXRTb3VyY2V9IGhhcyBzdGFydGVkIHRvIHRyaWdnZXIgc3FlZXplIGFjdGlvbi5cbiAgICAgKlxuICAgICAqIEBldmVudCBYcklucHV0I3NxdWVlemVzdGFydFxuICAgICAqIEBwYXJhbSB7WHJJbnB1dFNvdXJjZX0gaW5wdXRTb3VyY2UgLSBJbnB1dCBzb3VyY2UgdGhhdCB0cmlnZ2VyZWQgc3F1ZWV6ZXN0YXJ0IGV2ZW50LlxuICAgICAqIEBwYXJhbSB7b2JqZWN0fSBldnQgLSBYUklucHV0U291cmNlRXZlbnQgZXZlbnQgZGF0YSBmcm9tIFdlYlhSIEFQSS5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqIGFwcC54ci5pbnB1dC5vbignc3F1ZWV6ZXN0YXJ0JywgZnVuY3Rpb24gKGlucHV0U291cmNlLCBldnQpIHtcbiAgICAgKiAgICAgaWYgKG9iai5jb250YWluc1BvaW50KGlucHV0U291cmNlLmdldFBvc2l0aW9uKCkpKSB7XG4gICAgICogICAgICAgICAvLyBncmFiYmVkIGFuIG9iamVjdFxuICAgICAqICAgICB9XG4gICAgICogfSk7XG4gICAgICovXG5cbiAgICAvKipcbiAgICAgKiBGaXJlZCB3aGVuIHtAbGluayBYcklucHV0U291cmNlfSBoYXMgZW5kZWQgdHJpZ2dlcnJpbmcgc3FlZXplIGFjdGlvbi5cbiAgICAgKlxuICAgICAqIEBldmVudCBYcklucHV0I3NxdWVlemVlbmRcbiAgICAgKiBAcGFyYW0ge1hySW5wdXRTb3VyY2V9IGlucHV0U291cmNlIC0gSW5wdXQgc291cmNlIHRoYXQgdHJpZ2dlcmVkIHNxdWVlemVlbmQgZXZlbnQuXG4gICAgICogQHBhcmFtIHtvYmplY3R9IGV2dCAtIFhSSW5wdXRTb3VyY2VFdmVudCBldmVudCBkYXRhIGZyb20gV2ViWFIgQVBJLlxuICAgICAqL1xuXG4gICAgLyoqIEBwcml2YXRlICovXG4gICAgX29uU2Vzc2lvblN0YXJ0KCkge1xuICAgICAgICBjb25zdCBzZXNzaW9uID0gdGhpcy5tYW5hZ2VyLnNlc3Npb247XG4gICAgICAgIHNlc3Npb24uYWRkRXZlbnRMaXN0ZW5lcignaW5wdXRzb3VyY2VzY2hhbmdlJywgdGhpcy5fb25JbnB1dFNvdXJjZXNDaGFuZ2VFdnQpO1xuXG4gICAgICAgIHNlc3Npb24uYWRkRXZlbnRMaXN0ZW5lcignc2VsZWN0JywgKGV2dCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgaW5wdXRTb3VyY2UgPSB0aGlzLl9nZXRCeUlucHV0U291cmNlKGV2dC5pbnB1dFNvdXJjZSk7XG4gICAgICAgICAgICBpbnB1dFNvdXJjZS51cGRhdGUoZXZ0LmZyYW1lKTtcbiAgICAgICAgICAgIGlucHV0U291cmNlLmZpcmUoJ3NlbGVjdCcsIGV2dCk7XG4gICAgICAgICAgICB0aGlzLmZpcmUoJ3NlbGVjdCcsIGlucHV0U291cmNlLCBldnQpO1xuICAgICAgICB9KTtcbiAgICAgICAgc2Vzc2lvbi5hZGRFdmVudExpc3RlbmVyKCdzZWxlY3RzdGFydCcsIChldnQpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGlucHV0U291cmNlID0gdGhpcy5fZ2V0QnlJbnB1dFNvdXJjZShldnQuaW5wdXRTb3VyY2UpO1xuICAgICAgICAgICAgaW5wdXRTb3VyY2UudXBkYXRlKGV2dC5mcmFtZSk7XG4gICAgICAgICAgICBpbnB1dFNvdXJjZS5fc2VsZWN0aW5nID0gdHJ1ZTtcbiAgICAgICAgICAgIGlucHV0U291cmNlLmZpcmUoJ3NlbGVjdHN0YXJ0JywgZXZ0KTtcbiAgICAgICAgICAgIHRoaXMuZmlyZSgnc2VsZWN0c3RhcnQnLCBpbnB1dFNvdXJjZSwgZXZ0KTtcbiAgICAgICAgfSk7XG4gICAgICAgIHNlc3Npb24uYWRkRXZlbnRMaXN0ZW5lcignc2VsZWN0ZW5kJywgKGV2dCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgaW5wdXRTb3VyY2UgPSB0aGlzLl9nZXRCeUlucHV0U291cmNlKGV2dC5pbnB1dFNvdXJjZSk7XG4gICAgICAgICAgICBpbnB1dFNvdXJjZS51cGRhdGUoZXZ0LmZyYW1lKTtcbiAgICAgICAgICAgIGlucHV0U291cmNlLl9zZWxlY3RpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgIGlucHV0U291cmNlLmZpcmUoJ3NlbGVjdGVuZCcsIGV2dCk7XG4gICAgICAgICAgICB0aGlzLmZpcmUoJ3NlbGVjdGVuZCcsIGlucHV0U291cmNlLCBldnQpO1xuICAgICAgICB9KTtcblxuICAgICAgICBzZXNzaW9uLmFkZEV2ZW50TGlzdGVuZXIoJ3NxdWVlemUnLCAoZXZ0KSA9PiB7XG4gICAgICAgICAgICBjb25zdCBpbnB1dFNvdXJjZSA9IHRoaXMuX2dldEJ5SW5wdXRTb3VyY2UoZXZ0LmlucHV0U291cmNlKTtcbiAgICAgICAgICAgIGlucHV0U291cmNlLnVwZGF0ZShldnQuZnJhbWUpO1xuICAgICAgICAgICAgaW5wdXRTb3VyY2UuZmlyZSgnc3F1ZWV6ZScsIGV2dCk7XG4gICAgICAgICAgICB0aGlzLmZpcmUoJ3NxdWVlemUnLCBpbnB1dFNvdXJjZSwgZXZ0KTtcbiAgICAgICAgfSk7XG4gICAgICAgIHNlc3Npb24uYWRkRXZlbnRMaXN0ZW5lcignc3F1ZWV6ZXN0YXJ0JywgKGV2dCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgaW5wdXRTb3VyY2UgPSB0aGlzLl9nZXRCeUlucHV0U291cmNlKGV2dC5pbnB1dFNvdXJjZSk7XG4gICAgICAgICAgICBpbnB1dFNvdXJjZS51cGRhdGUoZXZ0LmZyYW1lKTtcbiAgICAgICAgICAgIGlucHV0U291cmNlLl9zcXVlZXppbmcgPSB0cnVlO1xuICAgICAgICAgICAgaW5wdXRTb3VyY2UuZmlyZSgnc3F1ZWV6ZXN0YXJ0JywgZXZ0KTtcbiAgICAgICAgICAgIHRoaXMuZmlyZSgnc3F1ZWV6ZXN0YXJ0JywgaW5wdXRTb3VyY2UsIGV2dCk7XG4gICAgICAgIH0pO1xuICAgICAgICBzZXNzaW9uLmFkZEV2ZW50TGlzdGVuZXIoJ3NxdWVlemVlbmQnLCAoZXZ0KSA9PiB7XG4gICAgICAgICAgICBjb25zdCBpbnB1dFNvdXJjZSA9IHRoaXMuX2dldEJ5SW5wdXRTb3VyY2UoZXZ0LmlucHV0U291cmNlKTtcbiAgICAgICAgICAgIGlucHV0U291cmNlLnVwZGF0ZShldnQuZnJhbWUpO1xuICAgICAgICAgICAgaW5wdXRTb3VyY2UuX3NxdWVlemluZyA9IGZhbHNlO1xuICAgICAgICAgICAgaW5wdXRTb3VyY2UuZmlyZSgnc3F1ZWV6ZWVuZCcsIGV2dCk7XG4gICAgICAgICAgICB0aGlzLmZpcmUoJ3NxdWVlemVlbmQnLCBpbnB1dFNvdXJjZSwgZXZ0KTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gYWRkIGlucHV0IHNvdXJjZXNcbiAgICAgICAgY29uc3QgaW5wdXRTb3VyY2VzID0gc2Vzc2lvbi5pbnB1dFNvdXJjZXM7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgaW5wdXRTb3VyY2VzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICB0aGlzLl9hZGRJbnB1dFNvdXJjZShpbnB1dFNvdXJjZXNbaV0pO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqIEBwcml2YXRlICovXG4gICAgX29uU2Vzc2lvbkVuZCgpIHtcbiAgICAgICAgbGV0IGkgPSB0aGlzLl9pbnB1dFNvdXJjZXMubGVuZ3RoO1xuICAgICAgICB3aGlsZSAoaS0tKSB7XG4gICAgICAgICAgICBjb25zdCBpbnB1dFNvdXJjZSA9IHRoaXMuX2lucHV0U291cmNlc1tpXTtcbiAgICAgICAgICAgIHRoaXMuX2lucHV0U291cmNlcy5zcGxpY2UoaSwgMSk7XG4gICAgICAgICAgICBpbnB1dFNvdXJjZS5maXJlKCdyZW1vdmUnKTtcbiAgICAgICAgICAgIHRoaXMuZmlyZSgncmVtb3ZlJywgaW5wdXRTb3VyY2UpO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3Qgc2Vzc2lvbiA9IHRoaXMubWFuYWdlci5zZXNzaW9uO1xuICAgICAgICBzZXNzaW9uLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2lucHV0c291cmNlc2NoYW5nZScsIHRoaXMuX29uSW5wdXRTb3VyY2VzQ2hhbmdlRXZ0KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge1hSSW5wdXRTb3VyY2VzQ2hhbmdlRXZlbnR9IGV2dCAtIFdlYlhSIGlucHV0IHNvdXJjZXMgY2hhbmdlIGV2ZW50LlxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgX29uSW5wdXRTb3VyY2VzQ2hhbmdlKGV2dCkge1xuICAgICAgICAvLyByZW1vdmVcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBldnQucmVtb3ZlZC5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgdGhpcy5fcmVtb3ZlSW5wdXRTb3VyY2UoZXZ0LnJlbW92ZWRbaV0pO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gYWRkXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZXZ0LmFkZGVkLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICB0aGlzLl9hZGRJbnB1dFNvdXJjZShldnQuYWRkZWRbaV0pO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHBhcmFtIHtYUklucHV0U291cmNlfSB4cklucHV0U291cmNlIC0gSW5wdXQgc291cmNlIHRvIHNlYXJjaCBmb3IuXG4gICAgICogQHJldHVybnMge1hySW5wdXRTb3VyY2V8bnVsbH0gVGhlIGlucHV0IHNvdXJjZSB0aGF0IG1hdGNoZXMgdGhlIGdpdmVuIFdlYlhSIGlucHV0IHNvdXJjZSBvclxuICAgICAqIG51bGwgaWYgbm8gbWF0Y2ggaXMgZm91bmQuXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBfZ2V0QnlJbnB1dFNvdXJjZSh4cklucHV0U291cmNlKSB7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5faW5wdXRTb3VyY2VzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5faW5wdXRTb3VyY2VzW2ldLmlucHV0U291cmNlID09PSB4cklucHV0U291cmNlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2lucHV0U291cmNlc1tpXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7WFJJbnB1dFNvdXJjZX0geHJJbnB1dFNvdXJjZSAtIElucHV0IHNvdXJjZSB0byBhZGQuXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBfYWRkSW5wdXRTb3VyY2UoeHJJbnB1dFNvdXJjZSkge1xuICAgICAgICBpZiAodGhpcy5fZ2V0QnlJbnB1dFNvdXJjZSh4cklucHV0U291cmNlKSlcbiAgICAgICAgICAgIHJldHVybjtcblxuICAgICAgICBjb25zdCBpbnB1dFNvdXJjZSA9IG5ldyBYcklucHV0U291cmNlKHRoaXMubWFuYWdlciwgeHJJbnB1dFNvdXJjZSk7XG4gICAgICAgIHRoaXMuX2lucHV0U291cmNlcy5wdXNoKGlucHV0U291cmNlKTtcbiAgICAgICAgdGhpcy5maXJlKCdhZGQnLCBpbnB1dFNvdXJjZSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHBhcmFtIHtYUklucHV0U291cmNlfSB4cklucHV0U291cmNlIC0gSW5wdXQgc291cmNlIHRvIHJlbW92ZS5cbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIF9yZW1vdmVJbnB1dFNvdXJjZSh4cklucHV0U291cmNlKSB7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5faW5wdXRTb3VyY2VzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5faW5wdXRTb3VyY2VzW2ldLmlucHV0U291cmNlICE9PSB4cklucHV0U291cmNlKVxuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuXG4gICAgICAgICAgICBjb25zdCBpbnB1dFNvdXJjZSA9IHRoaXMuX2lucHV0U291cmNlc1tpXTtcbiAgICAgICAgICAgIHRoaXMuX2lucHV0U291cmNlcy5zcGxpY2UoaSwgMSk7XG5cbiAgICAgICAgICAgIGxldCBoID0gaW5wdXRTb3VyY2UuaGl0VGVzdFNvdXJjZXMubGVuZ3RoO1xuICAgICAgICAgICAgd2hpbGUgKGgtLSkge1xuICAgICAgICAgICAgICAgIGlucHV0U291cmNlLmhpdFRlc3RTb3VyY2VzW2hdLnJlbW92ZSgpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpbnB1dFNvdXJjZS5maXJlKCdyZW1vdmUnKTtcbiAgICAgICAgICAgIHRoaXMuZmlyZSgncmVtb3ZlJywgaW5wdXRTb3VyY2UpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHBhcmFtIHsqfSBmcmFtZSAtIFhSRnJhbWUgZnJvbSByZXF1ZXN0QW5pbWF0aW9uRnJhbWUgY2FsbGJhY2suXG4gICAgICogQGlnbm9yZVxuICAgICAqL1xuICAgIHVwZGF0ZShmcmFtZSkge1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuX2lucHV0U291cmNlcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgdGhpcy5faW5wdXRTb3VyY2VzW2ldLnVwZGF0ZShmcmFtZSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBMaXN0IG9mIGFjdGl2ZSB7QGxpbmsgWHJJbnB1dFNvdXJjZX0gaW5zdGFuY2VzLlxuICAgICAqXG4gICAgICogQHR5cGUge1hySW5wdXRTb3VyY2VbXX1cbiAgICAgKi9cbiAgICBnZXQgaW5wdXRTb3VyY2VzKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5faW5wdXRTb3VyY2VzO1xuICAgIH1cbn1cblxuZXhwb3J0IHsgWHJJbnB1dCB9O1xuIl0sIm5hbWVzIjpbIlhySW5wdXQiLCJFdmVudEhhbmRsZXIiLCJjb25zdHJ1Y3RvciIsIm1hbmFnZXIiLCJfaW5wdXRTb3VyY2VzIiwiX29uSW5wdXRTb3VyY2VzQ2hhbmdlRXZ0IiwiZXZ0IiwiX29uSW5wdXRTb3VyY2VzQ2hhbmdlIiwib24iLCJfb25TZXNzaW9uU3RhcnQiLCJfb25TZXNzaW9uRW5kIiwic2Vzc2lvbiIsImFkZEV2ZW50TGlzdGVuZXIiLCJpbnB1dFNvdXJjZSIsIl9nZXRCeUlucHV0U291cmNlIiwidXBkYXRlIiwiZnJhbWUiLCJmaXJlIiwiX3NlbGVjdGluZyIsIl9zcXVlZXppbmciLCJpbnB1dFNvdXJjZXMiLCJpIiwibGVuZ3RoIiwiX2FkZElucHV0U291cmNlIiwic3BsaWNlIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsInJlbW92ZWQiLCJfcmVtb3ZlSW5wdXRTb3VyY2UiLCJhZGRlZCIsInhySW5wdXRTb3VyY2UiLCJYcklucHV0U291cmNlIiwicHVzaCIsImgiLCJoaXRUZXN0U291cmNlcyIsInJlbW92ZSJdLCJtYXBwaW5ncyI6Ijs7O0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU1BLE9BQU8sU0FBU0MsWUFBWSxDQUFDO0FBbUIvQjtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7RUFDSUMsV0FBV0EsQ0FBQ0MsT0FBTyxFQUFFO0FBQ2pCLElBQUEsS0FBSyxFQUFFLENBQUE7QUF6Qlg7QUFDSjtBQUNBO0FBQ0E7QUFISSxJQUFBLElBQUEsQ0FJQUEsT0FBTyxHQUFBLEtBQUEsQ0FBQSxDQUFBO0FBRVA7QUFDSjtBQUNBO0FBQ0E7SUFISSxJQUlBQyxDQUFBQSxhQUFhLEdBQUcsRUFBRSxDQUFBO0FBRWxCO0FBQ0o7QUFDQTtBQUNBO0FBSEksSUFBQSxJQUFBLENBSUFDLHdCQUF3QixHQUFBLEtBQUEsQ0FBQSxDQUFBO0lBV3BCLElBQUksQ0FBQ0YsT0FBTyxHQUFHQSxPQUFPLENBQUE7QUFFdEIsSUFBQSxJQUFJLENBQUNFLHdCQUF3QixHQUFJQyxHQUFHLElBQUs7QUFDckMsTUFBQSxJQUFJLENBQUNDLHFCQUFxQixDQUFDRCxHQUFHLENBQUMsQ0FBQTtLQUNsQyxDQUFBO0FBRUQsSUFBQSxJQUFJLENBQUNILE9BQU8sQ0FBQ0ssRUFBRSxDQUFDLE9BQU8sRUFBRSxJQUFJLENBQUNDLGVBQWUsRUFBRSxJQUFJLENBQUMsQ0FBQTtBQUNwRCxJQUFBLElBQUksQ0FBQ04sT0FBTyxDQUFDSyxFQUFFLENBQUMsS0FBSyxFQUFFLElBQUksQ0FBQ0UsYUFBYSxFQUFFLElBQUksQ0FBQyxDQUFBO0FBQ3BELEdBQUE7O0FBRUE7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtB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
