import { Debug } from '../../core/debug.js';

/**
 * Callback used by {@link ResourceLoader#load} when a resource is loaded (or an error occurs).
 *
 * @callback ResourceLoaderCallback
 * @param {string|null} err - The error message in the case where the load fails.
 * @param {*} [resource] - The resource that has been successfully loaded.
 */

/**
 * Load resource data, potentially from remote sources. Caches resource on load to prevent multiple
 * requests. Add ResourceHandlers to handle different types of resources.
 */
class ResourceLoader {
  /**
   * Create a new ResourceLoader instance.
   *
   * @param {import('../app-base.js').AppBase} app - The application.
   */
  constructor(app) {
    this._handlers = {};
    this._requests = {};
    this._cache = {};
    this._app = app;
  }

  /**
   * Add a {@link ResourceHandler} for a resource type. Handler should support at least `load()`
   * and `open()`. Handlers can optionally support patch(asset, assets) to handle dependencies on
   * other assets.
   *
   * @param {string} type - The name of the resource type that the handler will be registered
   * with. Can be:
   *
   * - {@link ASSET_ANIMATION}
   * - {@link ASSET_AUDIO}
   * - {@link ASSET_IMAGE}
   * - {@link ASSET_JSON}
   * - {@link ASSET_MODEL}
   * - {@link ASSET_MATERIAL}
   * - {@link ASSET_TEXT}
   * - {@link ASSET_TEXTURE}
   * - {@link ASSET_CUBEMAP}
   * - {@link ASSET_SHADER}
   * - {@link ASSET_CSS}
   * - {@link ASSET_HTML}
   * - {@link ASSET_SCRIPT}
   * - {@link ASSET_CONTAINER}
   *
   * @param {import('./handler.js').ResourceHandler} handler - An instance of a resource handler
   * supporting at least `load()` and `open()`.
   * @example
   * const loader = new ResourceLoader();
   * loader.addHandler("json", new pc.JsonHandler());
   */
  addHandler(type, handler) {
    this._handlers[type] = handler;
    handler._loader = this;
  }

  /**
   * Remove a {@link ResourceHandler} for a resource type.
   *
   * @param {string} type - The name of the type that the handler will be removed.
   */
  removeHandler(type) {
    delete this._handlers[type];
  }

  /**
   * Get a {@link ResourceHandler} for a resource type.
   *
   * @param {string} type - The name of the resource type that the handler is registered with.
   * @returns {import('./handler.js').ResourceHandler} The registered handler.
   */
  getHandler(type) {
    return this._handlers[type];
  }

  /**
   * Make a request for a resource from a remote URL. Parse the returned data using the handler
   * for the specified type. When loaded and parsed, use the callback to return an instance of
   * the resource.
   *
   * @param {string} url - The URL of the resource to load.
   * @param {string} type - The type of resource expected.
   * @param {ResourceLoaderCallback} callback - The callback used when the resource is loaded or
   * an error occurs. Passed (err, resource) where err is null if there are no errors.
   * @param {import('../asset/asset.js').Asset} [asset] - Optional asset that is passed into
   * handler.
   * @example
   * app.loader.load("../path/to/texture.png", "texture", function (err, texture) {
   *     // use texture here
   * });
   */
  load(url, type, callback, asset) {
    const handler = this._handlers[type];
    if (!handler) {
      const err = `No resource handler for asset type: '${type}' when loading [${url}]`;
      Debug.errorOnce(err);
      callback(err);
      return;
    }

    // handle requests with null file
    if (!url) {
      this._loadNull(handler, callback, asset);
      return;
    }
    const key = url + type;
    if (this._cache[key] !== undefined) {
      // in cache
      callback(null, this._cache[key]);
    } else if (this._requests[key]) {
      // existing request
      this._requests[key].push(callback);
    } else {
      // new request
      this._requests[key] = [callback];
      const self = this;
      const handleLoad = function handleLoad(err, urlObj) {
        if (err) {
          self._onFailure(key, err);
          return;
        }
        handler.load(urlObj, function (err, data, extra) {
          // make sure key exists because loader
          // might have been destroyed by now
          if (!self._requests[key]) {
            return;
          }
          if (err) {
            self._onFailure(key, err);
            return;
          }
          try {
            self._onSuccess(key, handler.open(urlObj.original, data, asset), extra);
          } catch (e) {
            self._onFailure(key, e);
          }
        }, asset);
      };
      const normalizedUrl = url.split('?')[0];
      if (this._app.enableBundles && this._app.bundles.hasUrl(normalizedUrl)) {
        if (!this._app.bundles.canLoadUrl(normalizedUrl)) {
          handleLoad(`Bundle for ${url} not loaded yet`);
          return;
        }
        this._app.bundles.loadUrl(normalizedUrl, function (err, fileUrlFromBundle) {
          handleLoad(err, {
            load: fileUrlFromBundle,
            original: normalizedUrl
          });
        });
      } else {
        handleLoad(null, {
          load: url,
          original: asset && asset.file.filename || url
        });
      }
    }
  }

  // load an asset with no url, skipping bundles and caching
  _loadNull(handler, callback, asset) {
    const onLoad = function onLoad(err, data, extra) {
      if (err) {
        callback(err);
      } else {
        try {
          callback(null, handler.open(null, data, asset), extra);
        } catch (e) {
          callback(e);
        }
      }
    };
    handler.load(null, onLoad, asset);
  }
  _onSuccess(key, result, extra) {
    this._cache[key] = result;
    for (let i = 0; i < this._requests[key].length; i++) {
      this._requests[key][i](null, result, extra);
    }
    delete this._requests[key];
  }
  _onFailure(key, err) {
    console.error(err);
    if (this._requests[key]) {
      for (let i = 0; i < this._requests[key].length; i++) {
        this._requests[key][i](err);
      }
      delete this._requests[key];
    }
  }

  /**
   * Convert raw resource data into a resource instance. E.g. Take 3D model format JSON and
   * return a {@link Model}.
   *
   * @param {string} type - The type of resource.
   * @param {*} data - The raw resource data.
   * @returns {*} The parsed resource data.
   */
  open(type, data) {
    const handler = this._handlers[type];
    if (!handler) {
      console.warn('No resource handler found for: ' + type);
      return data;
    }
    return handler.open(null, data);
  }

  /**
   * Perform any operations on a resource, that requires a dependency on its asset data or any
   * other asset data.
   *
   * @param {import('../asset/asset.js').Asset} asset - The asset to patch.
   * @param {import('../asset/asset-registry.js').AssetRegistry} assets - The asset registry.
   */
  patch(asset, assets) {
    const handler = this._handlers[asset.type];
    if (!handler) {
      console.warn('No resource handler found for: ' + asset.type);
      return;
    }
    if (handler.patch) {
      handler.patch(asset, assets);
    }
  }

  /**
   * Remove resource from cache.
   *
   * @param {string} url - The URL of the resource.
   * @param {string} type - The type of resource.
   */
  clearCache(url, type) {
    delete this._cache[url + type];
  }

  /**
   * Check cache for resource from a URL. If present, return the cached value.
   *
   * @param {string} url - The URL of the resource to get from the cache.
   * @param {string} type - The type of the resource.
   * @returns {*} The resource loaded from the cache.
   */
  getFromCache(url, type) {
    if (this._cache[url + type]) {
      return this._cache[url + type];
    }
    return undefined;
  }

  /**
   * Enables retrying of failed requests when loading assets.
   *
   * @param {number} maxRetries - The maximum number of times to retry loading an asset. Defaults
   * to 5.
   * @ignore
   */
  enableRetry(maxRetries = 5) {
    maxRetries = Math.max(0, maxRetries) || 0;
    for (const key in this._handlers) {
      this._handlers[key].maxRetries = maxRetries;
    }
  }

  /**
   * Disables retrying of failed requests when loading assets.
   *
   * @ignore
   */
  disableRetry() {
    for (const key in this._handlers) {
      this._handlers[key].maxRetries = 0;
    }
  }

  /**
   * Destroys the resource loader.
   */
  destroy() {
    this._handlers = {};
    this._requests = {};
    this._cache = {};
  }
}

export { ResourceLoader };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibG9hZGVyLmpzIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvZnJhbWV3b3JrL2hhbmRsZXJzL2xvYWRlci5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBEZWJ1ZyB9IGZyb20gJy4uLy4uL2NvcmUvZGVidWcuanMnO1xuXG4vKipcbiAqIENhbGxiYWNrIHVzZWQgYnkge0BsaW5rIFJlc291cmNlTG9hZGVyI2xvYWR9IHdoZW4gYSByZXNvdXJjZSBpcyBsb2FkZWQgKG9yIGFuIGVycm9yIG9jY3VycykuXG4gKlxuICogQGNhbGxiYWNrIFJlc291cmNlTG9hZGVyQ2FsbGJhY2tcbiAqIEBwYXJhbSB7c3RyaW5nfG51bGx9IGVyciAtIFRoZSBlcnJvciBtZXNzYWdlIGluIHRoZSBjYXNlIHdoZXJlIHRoZSBsb2FkIGZhaWxzLlxuICogQHBhcmFtIHsqfSBbcmVzb3VyY2VdIC0gVGhlIHJlc291cmNlIHRoYXQgaGFzIGJlZW4gc3VjY2Vzc2Z1bGx5IGxvYWRlZC5cbiAqL1xuXG4vKipcbiAqIExvYWQgcmVzb3VyY2UgZGF0YSwgcG90ZW50aWFsbHkgZnJvbSByZW1vdGUgc291cmNlcy4gQ2FjaGVzIHJlc291cmNlIG9uIGxvYWQgdG8gcHJldmVudCBtdWx0aXBsZVxuICogcmVxdWVzdHMuIEFkZCBSZXNvdXJjZUhhbmRsZXJzIHRvIGhhbmRsZSBkaWZmZXJlbnQgdHlwZXMgb2YgcmVzb3VyY2VzLlxuICovXG5jbGFzcyBSZXNvdXJjZUxvYWRlciB7XG4gICAgLyoqXG4gICAgICogQ3JlYXRlIGEgbmV3IFJlc291cmNlTG9hZGVyIGluc3RhbmNlLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtpbXBvcnQoJy4uL2FwcC1iYXNlLmpzJykuQXBwQmFzZX0gYXBwIC0gVGhlIGFwcGxpY2F0aW9uLlxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKGFwcCkge1xuICAgICAgICB0aGlzLl9oYW5kbGVycyA9IHt9O1xuICAgICAgICB0aGlzLl9yZXF1ZXN0cyA9IHt9O1xuICAgICAgICB0aGlzLl9jYWNoZSA9IHt9O1xuICAgICAgICB0aGlzLl9hcHAgPSBhcHA7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQWRkIGEge0BsaW5rIFJlc291cmNlSGFuZGxlcn0gZm9yIGEgcmVzb3VyY2UgdHlwZS4gSGFuZGxlciBzaG91bGQgc3VwcG9ydCBhdCBsZWFzdCBgbG9hZCgpYFxuICAgICAqIGFuZCBgb3BlbigpYC4gSGFuZGxlcnMgY2FuIG9wdGlvbmFsbHkgc3VwcG9ydCBwYXRjaChhc3NldCwgYXNzZXRzKSB0byBoYW5kbGUgZGVwZW5kZW5jaWVzIG9uXG4gICAgICogb3RoZXIgYXNzZXRzLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IHR5cGUgLSBUaGUgbmFtZSBvZiB0aGUgcmVzb3VyY2UgdHlwZSB0aGF0IHRoZSBoYW5kbGVyIHdpbGwgYmUgcmVnaXN0ZXJlZFxuICAgICAqIHdpdGguIENhbiBiZTpcbiAgICAgKlxuICAgICAqIC0ge0BsaW5rIEFTU0VUX0FOSU1BVElPTn1cbiAgICAgKiAtIHtAbGluayBBU1NFVF9BVURJT31cbiAgICAgKiAtIHtAbGluayBBU1NFVF9JTUFHRX1cbiAgICAgKiAtIHtAbGluayBBU1NFVF9KU09OfVxuICAgICAqIC0ge0BsaW5rIEFTU0VUX01PREVMfVxuICAgICAqIC0ge0BsaW5rIEFTU0VUX01BVEVSSUFMfVxuICAgICAqIC0ge0BsaW5rIEFTU0VUX1RFWFR9XG4gICAgICogLSB7QGxpbmsgQVNTRVRfVEVYVFVSRX1cbiAgICAgKiAtIHtAbGluayBBU1NFVF9DVUJFTUFQfVxuICAgICAqIC0ge0BsaW5rIEFTU0VUX1NIQURFUn1cbiAgICAgKiAtIHtAbGluayBBU1NFVF9DU1N9XG4gICAgICogLSB7QGxpbmsgQVNTRVRfSFRNTH1cbiAgICAgKiAtIHtAbGluayBBU1NFVF9TQ1JJUFR9XG4gICAgICogLSB7QGxpbmsgQVNTRVRfQ09OVEFJTkVSfVxuICAgICAqXG4gICAgICogQHBhcmFtIHtpbXBvcnQoJy4vaGFuZGxlci5qcycpLlJlc291cmNlSGFuZGxlcn0gaGFuZGxlciAtIEFuIGluc3RhbmNlIG9mIGEgcmVzb3VyY2UgaGFuZGxlclxuICAgICAqIHN1cHBvcnRpbmcgYXQgbGVhc3QgYGxvYWQoKWAgYW5kIGBvcGVuKClgLlxuICAgICAqIEBleGFtcGxlXG4gICAgICogY29uc3QgbG9hZGVyID0gbmV3IFJlc291cmNlTG9hZGVyKCk7XG4gICAgICogbG9hZGVyLmFkZEhhbmRsZXIoXCJqc29uXCIsIG5ldyBwYy5Kc29uSGFuZGxlcigpKTtcbiAgICAgKi9cbiAgICBhZGRIYW5kbGVyKHR5cGUsIGhhbmRsZXIpIHtcbiAgICAgICAgdGhpcy5faGFuZGxlcnNbdHlwZV0gPSBoYW5kbGVyO1xuICAgICAgICBoYW5kbGVyLl9sb2FkZXIgPSB0aGlzO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJlbW92ZSBhIHtAbGluayBSZXNvdXJjZUhhbmRsZXJ9IGZvciBhIHJlc291cmNlIHR5cGUuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gdHlwZSAtIFRoZSBuYW1lIG9mIHRoZSB0eXBlIHRoYXQgdGhlIGhhbmRsZXIgd2lsbCBiZSByZW1vdmVkLlxuICAgICAqL1xuICAgIHJlbW92ZUhhbmRsZXIodHlwZSkge1xuICAgICAgICBkZWxldGUgdGhpcy5faGFuZGxlcnNbdHlwZV07XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0IGEge0BsaW5rIFJlc291cmNlSGFuZGxlcn0gZm9yIGEgcmVzb3VyY2UgdHlwZS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSB0eXBlIC0gVGhlIG5hbWUgb2YgdGhlIHJlc291cmNlIHR5cGUgdGhhdCB0aGUgaGFuZGxlciBpcyByZWdpc3RlcmVkIHdpdGguXG4gICAgICogQHJldHVybnMge2ltcG9ydCgnLi9oYW5kbGVyLmpzJykuUmVzb3VyY2VIYW5kbGVyfSBUaGUgcmVnaXN0ZXJlZCBoYW5kbGVyLlxuICAgICAqL1xuICAgIGdldEhhbmRsZXIodHlwZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5faGFuZGxlcnNbdHlwZV07XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogTWFrZSBhIHJlcXVlc3QgZm9yIGEgcmVzb3VyY2UgZnJvbSBhIHJlbW90ZSBVUkwuIFBhcnNlIHRoZSByZXR1cm5lZCBkYXRhIHVzaW5nIHRoZSBoYW5kbGVyXG4gICAgICogZm9yIHRoZSBzcGVjaWZpZWQgdHlwZS4gV2hlbiBsb2FkZWQgYW5kIHBhcnNlZCwgdXNlIHRoZSBjYWxsYmFjayB0byByZXR1cm4gYW4gaW5zdGFuY2Ugb2ZcbiAgICAgKiB0aGUgcmVzb3VyY2UuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gdXJsIC0gVGhlIFVSTCBvZiB0aGUgcmVzb3VyY2UgdG8gbG9hZC5cbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gdHlwZSAtIFRoZSB0eXBlIG9mIHJlc291cmNlIGV4cGVjdGVkLlxuICAgICAqIEBwYXJhbSB7UmVzb3VyY2VMb2FkZXJDYWxsYmFja30gY2FsbGJhY2sgLSBUaGUgY2FsbGJhY2sgdXNlZCB3aGVuIHRoZSByZXNvdXJjZSBpcyBsb2FkZWQgb3JcbiAgICAgKiBhbiBlcnJvciBvY2N1cnMuIFBhc3NlZCAoZXJyLCByZXNvdXJjZSkgd2hlcmUgZXJyIGlzIG51bGwgaWYgdGhlcmUgYXJlIG5vIGVycm9ycy5cbiAgICAgKiBAcGFyYW0ge2ltcG9ydCgnLi4vYXNzZXQvYXNzZXQuanMnKS5Bc3NldH0gW2Fzc2V0XSAtIE9wdGlvbmFsIGFzc2V0IHRoYXQgaXMgcGFzc2VkIGludG9cbiAgICAgKiBoYW5kbGVyLlxuICAgICAqIEBleGFtcGxlXG4gICAgICogYXBwLmxvYWRlci5sb2FkKFwiLi4vcGF0aC90by90ZXh0dXJlLnBuZ1wiLCBcInRleHR1cmVcIiwgZnVuY3Rpb24gKGVyciwgdGV4dHVyZSkge1xuICAgICAqICAgICAvLyB1c2UgdGV4dHVyZSBoZXJlXG4gICAgICogfSk7XG4gICAgICovXG4gICAgbG9hZCh1cmwsIHR5cGUsIGNhbGxiYWNrLCBhc3NldCkge1xuICAgICAgICBjb25zdCBoYW5kbGVyID0gdGhpcy5faGFuZGxlcnNbdHlwZV07XG4gICAgICAgIGlmICghaGFuZGxlcikge1xuICAgICAgICAgICAgY29uc3QgZXJyID0gYE5vIHJlc291cmNlIGhhbmRsZXIgZm9yIGFzc2V0IHR5cGU6ICcke3R5cGV9JyB3aGVuIGxvYWRpbmcgWyR7dXJsfV1gO1xuICAgICAgICAgICAgRGVidWcuZXJyb3JPbmNlKGVycik7XG4gICAgICAgICAgICBjYWxsYmFjayhlcnIpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gaGFuZGxlIHJlcXVlc3RzIHdpdGggbnVsbCBmaWxlXG4gICAgICAgIGlmICghdXJsKSB7XG4gICAgICAgICAgICB0aGlzLl9sb2FkTnVsbChoYW5kbGVyLCBjYWxsYmFjaywgYXNzZXQpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3Qga2V5ID0gdXJsICsgdHlwZTtcblxuICAgICAgICBpZiAodGhpcy5fY2FjaGVba2V5XSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAvLyBpbiBjYWNoZVxuICAgICAgICAgICAgY2FsbGJhY2sobnVsbCwgdGhpcy5fY2FjaGVba2V5XSk7XG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy5fcmVxdWVzdHNba2V5XSkge1xuICAgICAgICAgICAgLy8gZXhpc3RpbmcgcmVxdWVzdFxuICAgICAgICAgICAgdGhpcy5fcmVxdWVzdHNba2V5XS5wdXNoKGNhbGxiYWNrKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vIG5ldyByZXF1ZXN0XG4gICAgICAgICAgICB0aGlzLl9yZXF1ZXN0c1trZXldID0gW2NhbGxiYWNrXTtcblxuICAgICAgICAgICAgY29uc3Qgc2VsZiA9IHRoaXM7XG5cbiAgICAgICAgICAgIGNvbnN0IGhhbmRsZUxvYWQgPSBmdW5jdGlvbiAoZXJyLCB1cmxPYmopIHtcbiAgICAgICAgICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgICAgICAgICAgIHNlbGYuX29uRmFpbHVyZShrZXksIGVycik7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBoYW5kbGVyLmxvYWQodXJsT2JqLCBmdW5jdGlvbiAoZXJyLCBkYXRhLCBleHRyYSkge1xuICAgICAgICAgICAgICAgICAgICAvLyBtYWtlIHN1cmUga2V5IGV4aXN0cyBiZWNhdXNlIGxvYWRlclxuICAgICAgICAgICAgICAgICAgICAvLyBtaWdodCBoYXZlIGJlZW4gZGVzdHJveWVkIGJ5IG5vd1xuICAgICAgICAgICAgICAgICAgICBpZiAoIXNlbGYuX3JlcXVlc3RzW2tleV0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuX29uRmFpbHVyZShrZXksIGVycik7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5fb25TdWNjZXNzKGtleSwgaGFuZGxlci5vcGVuKHVybE9iai5vcmlnaW5hbCwgZGF0YSwgYXNzZXQpLCBleHRyYSk7XG4gICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuX29uRmFpbHVyZShrZXksIGUpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSwgYXNzZXQpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgY29uc3Qgbm9ybWFsaXplZFVybCA9IHVybC5zcGxpdCgnPycpWzBdO1xuICAgICAgICAgICAgaWYgKHRoaXMuX2FwcC5lbmFibGVCdW5kbGVzICYmIHRoaXMuX2FwcC5idW5kbGVzLmhhc1VybChub3JtYWxpemVkVXJsKSkge1xuICAgICAgICAgICAgICAgIGlmICghdGhpcy5fYXBwLmJ1bmRsZXMuY2FuTG9hZFVybChub3JtYWxpemVkVXJsKSkge1xuICAgICAgICAgICAgICAgICAgICBoYW5kbGVMb2FkKGBCdW5kbGUgZm9yICR7dXJsfSBub3QgbG9hZGVkIHlldGApO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgdGhpcy5fYXBwLmJ1bmRsZXMubG9hZFVybChub3JtYWxpemVkVXJsLCBmdW5jdGlvbiAoZXJyLCBmaWxlVXJsRnJvbUJ1bmRsZSkge1xuICAgICAgICAgICAgICAgICAgICBoYW5kbGVMb2FkKGVyciwge1xuICAgICAgICAgICAgICAgICAgICAgICAgbG9hZDogZmlsZVVybEZyb21CdW5kbGUsXG4gICAgICAgICAgICAgICAgICAgICAgICBvcmlnaW5hbDogbm9ybWFsaXplZFVybFxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgaGFuZGxlTG9hZChudWxsLCB7XG4gICAgICAgICAgICAgICAgICAgIGxvYWQ6IHVybCxcbiAgICAgICAgICAgICAgICAgICAgb3JpZ2luYWw6IGFzc2V0ICYmIGFzc2V0LmZpbGUuZmlsZW5hbWUgfHwgdXJsXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBsb2FkIGFuIGFzc2V0IHdpdGggbm8gdXJsLCBza2lwcGluZyBidW5kbGVzIGFuZCBjYWNoaW5nXG4gICAgX2xvYWROdWxsKGhhbmRsZXIsIGNhbGxiYWNrLCBhc3NldCkge1xuICAgICAgICBjb25zdCBvbkxvYWQgPSBmdW5jdGlvbiAoZXJyLCBkYXRhLCBleHRyYSkge1xuICAgICAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycik7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKG51bGwsIGhhbmRsZXIub3BlbihudWxsLCBkYXRhLCBhc3NldCksIGV4dHJhKTtcbiAgICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKGUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgaGFuZGxlci5sb2FkKG51bGwsIG9uTG9hZCwgYXNzZXQpO1xuICAgIH1cblxuICAgIF9vblN1Y2Nlc3Moa2V5LCByZXN1bHQsIGV4dHJhKSB7XG4gICAgICAgIHRoaXMuX2NhY2hlW2tleV0gPSByZXN1bHQ7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5fcmVxdWVzdHNba2V5XS5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgdGhpcy5fcmVxdWVzdHNba2V5XVtpXShudWxsLCByZXN1bHQsIGV4dHJhKTtcbiAgICAgICAgfVxuICAgICAgICBkZWxldGUgdGhpcy5fcmVxdWVzdHNba2V5XTtcbiAgICB9XG5cbiAgICBfb25GYWlsdXJlKGtleSwgZXJyKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTtcbiAgICAgICAgaWYgKHRoaXMuX3JlcXVlc3RzW2tleV0pIHtcbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5fcmVxdWVzdHNba2V5XS5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIHRoaXMuX3JlcXVlc3RzW2tleV1baV0oZXJyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGRlbGV0ZSB0aGlzLl9yZXF1ZXN0c1trZXldO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ29udmVydCByYXcgcmVzb3VyY2UgZGF0YSBpbnRvIGEgcmVzb3VyY2UgaW5zdGFuY2UuIEUuZy4gVGFrZSAzRCBtb2RlbCBmb3JtYXQgSlNPTiBhbmRcbiAgICAgKiByZXR1cm4gYSB7QGxpbmsgTW9kZWx9LlxuICAgICAqXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IHR5cGUgLSBUaGUgdHlwZSBvZiByZXNvdXJjZS5cbiAgICAgKiBAcGFyYW0geyp9IGRhdGEgLSBUaGUgcmF3IHJlc291cmNlIGRhdGEuXG4gICAgICogQHJldHVybnMgeyp9IFRoZSBwYXJzZWQgcmVzb3VyY2UgZGF0YS5cbiAgICAgKi9cbiAgICBvcGVuKHR5cGUsIGRhdGEpIHtcbiAgICAgICAgY29uc3QgaGFuZGxlciA9IHRoaXMuX2hhbmRsZXJzW3R5cGVdO1xuICAgICAgICBpZiAoIWhhbmRsZXIpIHtcbiAgICAgICAgICAgIGNvbnNvbGUud2FybignTm8gcmVzb3VyY2UgaGFuZGxlciBmb3VuZCBmb3I6ICcgKyB0eXBlKTtcbiAgICAgICAgICAgIHJldHVybiBkYXRhO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGhhbmRsZXIub3BlbihudWxsLCBkYXRhKTtcblxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFBlcmZvcm0gYW55IG9wZXJhdGlvbnMgb24gYSByZXNvdXJjZSwgdGhhdCByZXF1aXJlcyBhIGRlcGVuZGVuY3kgb24gaXRzIGFzc2V0IGRhdGEgb3IgYW55XG4gICAgICogb3RoZXIgYXNzZXQgZGF0YS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7aW1wb3J0KCcuLi9hc3NldC9hc3NldC5qcycpLkFzc2V0fSBhc3NldCAtIFRoZSBhc3NldCB0byBwYXRjaC5cbiAgICAgKiBAcGFyYW0ge2ltcG9ydCgnLi4vYXNzZXQvYXNzZXQtcmVnaXN0cnkuanMnKS5Bc3NldFJlZ2lzdHJ5fSBhc3NldHMgLSBUaGUgYXNzZXQgcmVnaXN0cnkuXG4gICAgICovXG4gICAgcGF0Y2goYXNzZXQsIGFzc2V0cykge1xuICAgICAgICBjb25zdCBoYW5kbGVyID0gdGhpcy5faGFuZGxlcnNbYXNzZXQudHlwZV07XG4gICAgICAgIGlmICghaGFuZGxlcikgIHtcbiAgICAgICAgICAgIGNvbnNvbGUud2FybignTm8gcmVzb3VyY2UgaGFuZGxlciBmb3VuZCBmb3I6ICcgKyBhc3NldC50eXBlKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChoYW5kbGVyLnBhdGNoKSB7XG4gICAgICAgICAgICBoYW5kbGVyLnBhdGNoKGFzc2V0LCBhc3NldHMpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmVtb3ZlIHJlc291cmNlIGZyb20gY2FjaGUuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gdXJsIC0gVGhlIFVSTCBvZiB0aGUgcmVzb3VyY2UuXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IHR5cGUgLSBUaGUgdHlwZSBvZiByZXNvdXJjZS5cbiAgICAgKi9cbiAgICBjbGVhckNhY2hlKHVybCwgdHlwZSkge1xuICAgICAgICBkZWxldGUgdGhpcy5fY2FjaGVbdXJsICsgdHlwZV07XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ2hlY2sgY2FjaGUgZm9yIHJlc291cmNlIGZyb20gYSBVUkwuIElmIHByZXNlbnQsIHJldHVybiB0aGUgY2FjaGVkIHZhbHVlLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IHVybCAtIFRoZSBVUkwgb2YgdGhlIHJlc291cmNlIHRvIGdldCBmcm9tIHRoZSBjYWNoZS5cbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gdHlwZSAtIFRoZSB0eXBlIG9mIHRoZSByZXNvdXJjZS5cbiAgICAgKiBAcmV0dXJucyB7Kn0gVGhlIHJlc291cmNlIGxvYWRlZCBmcm9tIHRoZSBjYWNoZS5cbiAgICAgKi9cbiAgICBnZXRGcm9tQ2FjaGUodXJsLCB0eXBlKSB7XG4gICAgICAgIGlmICh0aGlzLl9jYWNoZVt1cmwgKyB0eXBlXSkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2NhY2hlW3VybCArIHR5cGVdO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRW5hYmxlcyByZXRyeWluZyBvZiBmYWlsZWQgcmVxdWVzdHMgd2hlbiBsb2FkaW5nIGFzc2V0cy5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBtYXhSZXRyaWVzIC0gVGhlIG1heGltdW0gbnVtYmVyIG9mIHRpbWVzIHRvIHJldHJ5IGxvYWRpbmcgYW4gYXNzZXQuIERlZmF1bHRzXG4gICAgICogdG8gNS5cbiAgICAgKiBAaWdub3JlXG4gICAgICovXG4gICAgZW5hYmxlUmV0cnkobWF4UmV0cmllcyA9IDUpIHtcbiAgICAgICAgbWF4UmV0cmllcyA9IE1hdGgubWF4KDAsIG1heFJldHJpZXMpIHx8IDA7XG5cbiAgICAgICAgZm9yIChjb25zdCBrZXkgaW4gdGhpcy5faGFuZGxlcnMpIHtcbiAgICAgICAgICAgIHRoaXMuX2hhbmRsZXJzW2tleV0ubWF4UmV0cmllcyA9IG1heFJldHJpZXM7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBEaXNhYmxlcyByZXRyeWluZyBvZiBmYWlsZWQgcmVxdWVzdHMgd2hlbiBsb2FkaW5nIGFzc2V0cy5cbiAgICAgKlxuICAgICAqIEBpZ25vcmVcbiAgICAgKi9cbiAgICBkaXNhYmxlUmV0cnkoKSB7XG4gICAgICAgIGZvciAoY29uc3Qga2V5IGluIHRoaXMuX2hhbmRsZXJzKSB7XG4gICAgICAgICAgICB0aGlzLl9oYW5kbGVyc1trZXldLm1heFJldHJpZXMgPSAwO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRGVzdHJveXMgdGhlIHJlc291cmNlIGxvYWRlci5cbiAgICAgKi9cbiAgICBkZXN0cm95KCkge1xuICAgICAgICB0aGlzLl9oYW5kbGVycyA9IHt9O1xuICAgICAgICB0aGlzLl9yZXF1ZXN0cyA9IHt9O1xuICAgICAgICB0aGlzLl9jYWNoZSA9IHt9O1xuICAgIH1cbn1cblxuZXhwb3J0IHsgUmVzb3VyY2VMb2FkZXIgfTtcbiJdLCJuYW1lcyI6WyJSZXNvdXJjZUxvYWRlciIsImNvbnN0cnVjdG9yIiwiYXBwIiwiX2hhbmRsZXJzIiwiX3JlcXVlc3RzIiwiX2NhY2hlIiwiX2FwcCIsImFkZEhhbmRsZXIiLCJ0eXBlIiwiaGFuZGxlciIsIl9sb2FkZXIiLCJyZW1vdmVIYW5kbGVyIiwiZ2V0SGFuZGxlciIsImxvYWQiLCJ1cmwiLCJjYWxsYmFjayIsImFzc2V0IiwiZXJyIiwiRGVidWciLCJlcnJvck9uY2UiLCJfbG9hZE51bGwiLCJrZXkiLCJ1bmRlZmluZWQiLCJwdXNoIiwic2VsZiIsImhhbmRsZUxvYWQiLCJ1cmxPYmoiLCJfb25GYWlsdXJlIiwiZGF0YSIsImV4dHJhIiwiX29uU3VjY2VzcyIsIm9wZW4iLCJvcmlnaW5hbCIsImUiLCJub3JtYWxpemVkVXJsIiwic3BsaXQiLCJlbmFibGVCdW5kbGVzIiwiYnVuZGxlcyIsImhhc1VybCIsImNhbkxvYWRVcmwiLCJsb2FkVXJsIiwiZmlsZVVybEZyb21CdW5kbGUiLCJmaWxlIiwiZmlsZW5hbWUiLCJvbkxvYWQiLCJyZXN1bHQiLCJpIiwibGVuZ3RoIiwiY29uc29sZSIsImVycm9yIiwid2FybiIsInBhdGNoIiwiYXNzZXRzIiwiY2xlYXJDYWNoZSIsImdldEZyb21DYWNoZSIsImVuYWJsZVJldHJ5IiwibWF4UmV0cmllcyIsIk1hdGgiLCJtYXgiLCJkaXNhYmxlUmV0cnkiLCJkZXN0cm95Il0sIm1hcHBpbmdzIjoiOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTUEsY0FBYyxDQUFDO0FBQ2pCO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7RUFDSUMsV0FBV0EsQ0FBQ0MsR0FBRyxFQUFFO0FBQ2IsSUFBQSxJQUFJLENBQUNDLFNBQVMsR0FBRyxFQUFFLENB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
