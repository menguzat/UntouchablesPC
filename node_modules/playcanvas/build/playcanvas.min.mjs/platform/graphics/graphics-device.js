import{extends as e}from"../../_virtual/_rollupPluginBabelHelpers.js";import"../../core/debug.js";import{EventHandler as t}from"../../core/event-handler.js";import{platform as i}from"../../core/platform.js";import"../../core/time.js";import{CLEARFLAG_COLOR as s,CLEARFLAG_DEPTH as r,PRIMITIVE_TRIFAN as n,SEMANTIC_POSITION as a,TYPE_FLOAT32 as h,BUFFER_STATIC as o,CULLFACE_BACK as l,PRIMITIVE_POINTS as d}from"./constants.js";import{BlendState as m}from"./blend-state.js";import{DepthState as u}from"./depth-state.js";import{ScopeSpace as f}from"./scope-space.js";import{VertexBuffer as p}from"./vertex-buffer.js";import{VertexFormat as c}from"./vertex-format.js";import{StencilParameters as v}from"./stencil-parameters.js";class x extends t{constructor(t,a){var h,o,l,p;super(),this.canvas=void 0,this.isWebGPU=!1,this.scope=void 0,this.boneLimit=void 0,this.maxAnisotropy=void 0,this.maxCubeMapSize=void 0,this.maxTextureSize=void 0,this.maxVolumeSize=void 0,this.precision=void 0,this.samples=void 0,this.supportsStencil=void 0,this.renderTarget=null,this.renderPassIndex=void 0,this.insideRenderPass=!1,this.supportsInstancing=void 0,this.supportsUniformBuffers=!1,this.textureFloatRenderable=void 0,this.textureHalfFloatRenderable=void 0,this.quadVertexBuffer=void 0,this.blendState=new m,this.depthState=new u,this.stencilEnabled=!1,this.stencilFront=new v,this.stencilBack=new v,this.defaultClearOptions={color:[0,0,0,1],depth:1,stencil:0,flags:s|r},this.canvas=t,this.initOptions=e({},a),null!=(h=this.initOptions).depth||(h.depth=!0),null!=(o=this.initOptions).stencil||(o.stencil=!0),null!=(l=this.initOptions).antialias||(l.antialias=!0),null!=(p=this.initOptions).powerPreference||(p.powerPreference="high-performance"),this._width=0,this._height=0,this._maxPixelRatio=i.browser?Math.min(1,window.devicePixelRatio):1,this.shaders=[],this.buffers=[],this.textures=[],this.targets=[],this._vram={tex:0,vb:0,ib:0,ub:0},this._shaderStats={vsCompiled:0,fsCompiled:0,linked:0,materialShaders:0,compileTime:0},this.initializeContextCaches(),this._drawCallsPerFrame=0,this._shaderSwitchesPerFrame=0,this._primsPerFrame=[];for(let e=d;e<=n;e++)this._primsPerFrame[e]=0;this._renderTargetCreationTime=0,this.scope=new f("Device"),this.textureBias=this.scope.resolve("textureBias"),this.textureBias.setValue(0)}postInit(){const e=new c(this,[{semantic:a,components:2,type:h}]),t=new Float32Array([-1,-1,1,-1,-1,1,1,1]);this.quadVertexBuffer=new p(this,e,4,o,t)}destroy(){var e;this.fire("destroy"),null==(e=this.quadVertexBuffer)||e.destroy(),this.quadVertexBuffer=null}onDestroyShader(e){this.fire("destroy:shader",e);const t=this.shaders.indexOf(e);-1!==t&&this.shaders.splice(t,1)}postDestroy(){this.scope=null,this.canvas=null}toJSON(e){}initializeContextCaches(){this.indexBuffer=null,this.vertexBuffers=[],this.shader=null,this.renderTarget=null}initializeRenderState(){this.blendState=new m,this.depthState=new u,this.cullMode=l,this.vx=this.vy=this.vw=this.vh=0,this.sx=this.sy=this.sw=this.sh=0}setStencilState(e,t){}setBlendState(e){}setDepthState(e){}setCullMode(e){}setRenderTarget(e){this.renderTarget=e}setIndexBuffer(e){this.indexBuffer=e}setVertexBuffer(e){e&&this.vertexBuffers.push(e)}getRenderTarget(){return this.renderTarget}initRenderTarget(e){e.initialized||(e.init(),this.targets.push(e))}_isBrowserInterface(e){return this._isImageBrowserInterface(e)||this._isImageCanvasInterface(e)||this._isImageVideoInterface(e)}_isImageBrowserInterface(e){return"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement}_isImageCanvasInterface(e){return"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement}_isImageVideoInterface(e){return"undefined"!=typeof HTMLVideoElement&&e instanceof HTMLVideoElement}resizeCanvas(e,t){}setResolution(e,t){this._width=e,this._height=t,this.canvas.width=e,this.canvas.height=t,this.fire(x.EVENT_RESIZE,e,t)}updateClientRect(){this.clientRect=this.canvas.getBoundingClientRect()}get width(){return this.canvas.width}get height(){return this.canvas.height}set fullscreen(e){}get fullscreen(){return!1}set maxPixelRatio(e){this._maxPixelRatio!==e&&(this._maxPixelRatio=e,this.resizeCanvas(this._width,this._height))}get maxPixelRatio(){return this._maxPixelRatio}get deviceType(){return this._deviceType}getBoneLimit(){return this.boneLimit}setBoneLimit(e){this.boneLimit=e}frameStart(){this.renderPassIndex=0}}x.EVENT_RESIZE="resizecanvas";export{x as GraphicsDevice};
