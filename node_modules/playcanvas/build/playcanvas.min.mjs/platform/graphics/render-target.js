import"../../core/debug.js";import{PIXELFORMAT_DEPTH as e,PIXELFORMAT_DEPTHSTENCIL as t}from"./constants.js";import{GraphicsDevice as i}from"./graphics-device.js";let s=0;class h{constructor(h={}){var r,l,f,o,n,d;this.id=s++;const u=arguments[1],c=arguments[2];if(h instanceof i?(this._colorBuffer=u,h=c):this._colorBuffer=h.colorBuffer,this._colorBuffer&&(this._colorBuffer._isRenderTarget=!0),this._depthBuffer=h.depthBuffer,this._face=null!=(r=h.face)?r:0,this._depthBuffer){const i=this._depthBuffer._format;i===e?(this._depth=!0,this._stencil=!1):i===t?(this._depth=!0,this._stencil=!0):(this._depth=!1,this._stencil=!1)}else{var _,a;this._depth=null==(_=h.depth)||_,this._stencil=null!=(a=h.stencil)&&a}const p=(null==(l=this._colorBuffer)?void 0:l.device)||(null==(f=this._depthBuffer)?void 0:f.device)||h.graphicsDevice;this._device=p;const{maxSamples:m}=this._device;var v,B;(this._samples=Math.min(null!=(o=h.samples)?o:1,m),p.isWebGPU&&(this._samples=this._samples>1?m:1),this.autoResolve=null==(n=h.autoResolve)||n,this.name=h.name,this.name)||(this.name=null==(v=this._colorBuffer)?void 0:v.name);this.name||(this.name=null==(B=this._depthBuffer)?void 0:B.name);this.name||(this.name="Untitled"),this.flipY=null!=(d=h.flipY)&&d,this.impl=p.createRenderTargetImpl(this)}destroy(){const e=this._device;if(e){const t=e.targets.indexOf(this);-1!==t&&e.targets.splice(t,1),e.renderTarget===this&&e.setRenderTarget(null),this.destroyFrameBuffers()}}destroyFrameBuffers(){const e=this._device;e&&this.impl.destroy(e)}destroyTextureBuffers(){this._depthBuffer&&(this._depthBuffer.destroy(),this._depthBuffer=null),this._colorBuffer&&(this._colorBuffer.destroy(),this._colorBuffer=null)}init(){this.impl.init(this._device,this)}get initialized(){return this.impl.initialized}loseContext(){this.impl.loseContext()}resolve(e=!0,t=!!this._depthBuffer){this._device&&this._samples>1&&this.impl.resolve(this._device,this,e,t)}copy(e,t,i){if(!this._device){if(!e._device)return!1;this._device=e._device}return this._device.copyRenderTarget(e,this,t,i)}get samples(){return this._samples}get depth(){return this._depth}get stencil(){return this._stencil}get colorBuffer(){return this._colorBuffer}get depthBuffer(){return this._depthBuffer}get face(){return this._face}get width(){var e,t;return(null==(e=this._colorBuffer)?void 0:e.width)||(null==(t=this._depthBuffer)?void 0:t.width)||this._device.width}get height(){var e,t;return(null==(e=this._colorBuffer)?void 0:e.height)||(null==(t=this._depthBuffer)?void 0:t.height)||this._device.height}}export{h as RenderTarget};
