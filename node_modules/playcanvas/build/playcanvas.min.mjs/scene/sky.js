import{CULLFACE_FRONT as e}from"../platform/graphics/constants.js";import{ShaderProcessorOptions as s}from"../platform/graphics/shader-processor-options.js";import{SHADER_FORWARDHDR as t,GAMMA_SRGBHDR as r,GAMMA_NONE as a,TONEMAP_LINEAR as o,LAYERID_SKYBOX as n}from"./constants.js";import{createBox as m}from"./procedural.js";import{GraphNode as i}from"./graph-node.js";import{Material as p}from"./materials/material.js";import{MeshInstance as c}from"./mesh-instance.js";import{getProgramLibrary as h}from"./shader-lib/get-program-library.js";import{skybox as y}from"./shader-lib/programs/skybox.js";class l{constructor(l,g,b){this.meshInstance=void 0;const f=new p;f.getShaderVariant=function(e,n,m,i,p,c,f,u){const d={pass:p,encoding:b.encoding,useIntensity:1!==g.skyboxIntensity||g.physicalUnits,gamma:p===t?g.gammaCorrection?r:a:g.gammaCorrection,toneMapping:p===t?o:g.toneMapping};b.cubemap?(d.type="cubemap",d.mip=b.fixCubemapSeams?g.skyboxMip:0,d.fixSeams=b.fixCubemapSeams):d.type="envAtlas";const x=new s(f,u),k=h(l);return k.register("skybox",y),k.getProgram("skybox",d,x)},b.cubemap?f.setParameter("texture_cubeMap",b):(f.setParameter("texture_envAtlas",b),f.setParameter("mipLevel",g._skyboxMip)),f.cull=e,f.depthWrite=!1;const u=g.layers.getLayerById(n);if(u){const e=new i("Skybox"),s=m(l),t=new c(s,f,e);this.meshInstance=t,t.cull=!1,t._noDepthDrawGl1=!0,t.pick=!1,u.addMeshInstances([t]),this.skyLayer=u}}destroy(){this.meshInstance&&(this.skyLayer&&this.skyLayer.removeMeshInstances([this.meshInstance]),this.meshInstance.destroy(),this.meshInstance=null)}}export{l as Sky};
