import{path as t}from"../../core/path.js";import"../../core/debug.js";import{Http as e,http as o}from"../../platform/net/http.js";import{hasAudioContext as n}from"../../platform/audio/capabilities.js";import{Sound as r}from"../../platform/sound/sound.js";const i=function(){if("undefined"==typeof window)return!1;const t=window.navigator.userAgent,e=t.indexOf("MSIE ");if(e>0)return parseInt(t.substring(e+5,t.indexOf(".",e)),10);if(t.indexOf("Trident/")>0){const e=t.indexOf("rv:");return parseInt(t.substring(e+3,t.indexOf(".",e)),10)}return!1}(),s=[".ogg",".mp3",".wav",".mp4a",".m4a",".mp4",".aac",".opus"];class a{constructor(t){this.handlerType="audio",this.manager=t.soundManager,this.maxRetries=0}_isSupported(e){const o=t.getExtension(e);return s.indexOf(o)>-1}load(t,e){"string"==typeof t&&(t={load:t,original:t});const o=function(t){e(null,new r(t))},n=function(o){let n="Error loading audio url: "+t.original;o&&(n+=": "+(o.message||o)),console.warn(n),e(n)};if(this._createSound){if(!this._isSupported(t.original))return void n(`Audio format for ${t.original} not supported`);this._createSound(t.load,o,n)}else n(null)}open(t,e){return e}patch(t,e){}_createSound(t,r,s){if(n()){const n=this.manager;if(!n.context)return void s("Audio manager has no audio context");const i={retry:this.maxRetries>0,maxRetries:this.maxRetries};(t.startsWith("blob:")||t.startsWith("data:"))&&(i.responseType=e.ResponseType.ARRAY_BUFFER),o.get(t,i,(function(t,e){t?s(t):n.context.decodeAudioData(e,r,s)}))}else{let e=null;try{e=new Audio}catch(t){return void s("No support for Audio element")}i&&document.body.appendChild(e);const o=function t(){e.removeEventListener("canplaythrough",t),i&&document.body.removeChild(e),r(e)};e.onerror=function(){e.onerror=null,i&&document.body.removeChild(e),s()},e.addEventListener("canplaythrough",o),e.src=t}}}export{a as AudioHandler};
