import{extends as t}from"../../../_virtual/_rollupPluginBabelHelpers.js";import"../../../core/debug.js";import{PIXELFORMAT_RGB8 as e,ADDRESS_CLAMP_TO_EDGE as a,ADDRESS_REPEAT as r,PIXELFORMAT_DXT1 as o,PIXELFORMAT_DXT5 as s,PIXELFORMAT_RGBA16F as l,PIXELFORMAT_RGBA32F as m,PIXELFORMAT_ETC1 as n,PIXELFORMAT_PVRTC_2BPP_RGB_1 as h,PIXELFORMAT_PVRTC_2BPP_RGBA_1 as i,PIXELFORMAT_PVRTC_4BPP_RGB_1 as f,PIXELFORMAT_PVRTC_4BPP_RGBA_1 as p,PIXELFORMAT_RGBA8 as c}from"../../../platform/graphics/constants.js";import{Texture as d}from"../../../platform/graphics/texture.js";import{Asset as u}from"../../asset/asset.js";class x{constructor(t){this.maxRetries=0}load(t,e,a){u.fetchArrayBuffer(t.load,e,a,this.maxRetries)}open(u,x,M,w={}){const g=new Uint32Array(x,0,32),y=g[4],_=g[3],j=Math.max(g[7],1),v=4===g[20],A=g[21],U=g[22],b=65024===g[28],B=827611204,R=825438800,F=825439312;let H,P=!1,V=!1,k=!1,q=!1,z=null,C=1;if(v?A===B?(z=o,P=!0):894720068===A?(z=s,P=!0):113===A?(z=l,C=2):116===A?(z=m,C=4):826496069===A?(z=n,P=!0,V=!0):A===R||825504336===A?(z=A===R?h:i,P=!0,k=!0):A!==F&&825504848!==A||(z=A===F?f:p,P=!0,q=!0):32===U&&(z=c),!z)return H=new d(M,{width:4,height:4,format:e,name:"dds-legacy-empty"}),H;H=new d(M,t({name:u,addressU:b?a:r,addressV:b?a:r,width:y,height:_,format:z,cubemap:b,mipmaps:j>1},w));let D=128;const E=b?6:1;let G;const I=A===B?8:16;let J,K,L;for(let t=0;t<E;t++){let e=y,a=_;for(let r=0;r<j;r++){P?V?G=Math.floor((e+3)/4)*Math.floor((a+3)/4)*8:k?G=Math.max(e,16)*Math.max(a,8)/4:q?G=Math.max(e,8)*Math.max(a,8)/2:(J=Math.floor((e+4-1)/4),K=Math.floor((a+4-1)/4),L=J*K,G=L*I):G=e*a*4;const o=z===m?new Float32Array(x,D,G):z===l?new Uint16Array(x,D,G):new Uint8Array(x,D,G);b?(H._levels[r]||(H._levels[r]=[]),H._levels[r][t]=o):H._levels[r]=o,D+=G*C,e=Math.max(.5*e,1),a=Math.max(.5*a,1)}}return H.upload(),H}}export{x as DdsParser};
