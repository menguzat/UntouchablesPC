import"../../core/debug.js";import{EventHandler as t}from"../../core/event-handler.js";import{script as e}from"../script.js";import{AppBase as r}from"../app-base.js";import{ScriptAttributes as o}from"./script-attributes.js";import{ScriptType as s}from"./script-type.js";import{ScriptTypes as n}from"./script-types.js";const i=new Set(["system","entity","create","destroy","swap","move","data","scripts","_scripts","_scriptsIndex","_scriptsData","enabled","_oldState","onEnable","onDisable","onPostStateChange","_onSetEnabled","_checkState","_onBeforeRemove","_onInitializeAttributes","_onInitialize","_onPostInitialize","_onUpdate","_onPostUpdate","_callbacks","has","get","on","off","fire","once","hasEvent"]);function a(){return i}function c(r,n){if(e.legacy)return null;if(i.has(r))throw new Error(`Script name '${r}' is reserved, please rename the script`);const a=function(e){t.prototype.initEventHandler.call(this),s.prototype.initScriptType.call(this,e)};return(a.prototype=Object.create(s.prototype)).constructor=a,a.extend=s.extend,a.attributes=new o(a),l(a,r,n),a}const p={};function l(t,e,o){if(t.legacy)return;if("function"!=typeof t)throw new Error(`script class: '${t}' must be a constructor function (i.e. class).`);if(!(t.prototype instanceof s))throw new Error(`script class: '${s.__getScriptName(t)}' does not extend pc.ScriptType.`);if(e=e||t.__name||s.__getScriptName(t),i.has(e))throw new Error(`script name: '${e}' is reserved, please change script name`);t.__name=e;(o?o.scripts:r.getApplication().scripts).add(t),n.push(t,t.legacy)}o.reservedNames.forEach(((t,e,r)=>{p[t]=1})),c.reservedAttributes=p;export{c as createScript,a as getReservedScriptNames,l as registerScript};
